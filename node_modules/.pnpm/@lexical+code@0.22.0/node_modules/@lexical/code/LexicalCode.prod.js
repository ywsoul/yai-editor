/**
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 */

'use strict';var d=require("@lexical/utils"),m=require("lexical");require("prismjs");require("prismjs/components/prism-clike");require("prismjs/components/prism-javascript");require("prismjs/components/prism-markup");require("prismjs/components/prism-markdown");require("prismjs/components/prism-c");require("prismjs/components/prism-css");require("prismjs/components/prism-objectivec");require("prismjs/components/prism-sql");require("prismjs/components/prism-powershell");require("prismjs/components/prism-python");
require("prismjs/components/prism-rust");require("prismjs/components/prism-swift");require("prismjs/components/prism-typescript");require("prismjs/components/prism-java");require("prismjs/components/prism-cpp");"use strict";var q;
function v(a){let b=new URLSearchParams;b.append("code",a);for(let c=1;c<arguments.length;c++)b.append("v",arguments[c]);throw Error(`Minified Lexical error #${a}; visit https://lexical.dev/docs/error?${b} for the full message or `+"use the non-minified dev environment for full errors and additional helpful warnings.");}q=v&&v.__esModule&&Object.prototype.hasOwnProperty.call(v,"default")?v["default"]:v;let x=globalThis.Prism||window.Prism,y=a=>{try{return a?x.languages.hasOwnProperty(a):!1}catch(b){return!1}};
function z(a,b){for(let c of a.childNodes){if(d.isHTMLElement(c)&&c.tagName===b)return!0;z(c,b)}return!1}
class A extends m.ElementNode{static getType(){return"code"}static clone(a){return new A(a.__language,a.__key)}constructor(a,b){super(b);this.__language=a;this.__isSyntaxHighlightSupported=y(a)}createDOM(a){let b=document.createElement("code");d.addClassNamesToElement(b,a.theme.code);b.setAttribute("spellcheck","false");if(a=this.getLanguage())b.setAttribute("data-language",a),this.getIsSyntaxHighlightSupported()&&b.setAttribute("data-highlight-language",a);return b}updateDOM(a,b){let c=this.__language,
e=a.__language;c?c!==e&&(b.setAttribute("data-language",c),this.__isSyntaxHighlightSupported&&b.setAttribute("data-highlight-language",c)):e&&(b.removeAttribute("data-language"),a.__isSyntaxHighlightSupported&&b.removeAttribute("data-highlight-language"));return!1}exportDOM(a){let b=document.createElement("pre");d.addClassNamesToElement(b,a._config.theme.code);b.setAttribute("spellcheck","false");if(a=this.getLanguage())b.setAttribute("data-language",a),this.getIsSyntaxHighlightSupported()&&b.setAttribute("data-highlight-language",
a);return{element:b}}static importDOM(){return{code:a=>null!=a.textContent&&(/\r?\n/.test(a.textContent)||z(a,"BR"))?{conversion:B,priority:1}:null,div:()=>({conversion:aa,priority:1}),pre:()=>({conversion:B,priority:0}),table:a=>C(a)?{conversion:ba,priority:3}:null,td:a=>{let b=a.closest("table");return a.classList.contains("js-file-line")||b&&C(b)?{conversion:D,priority:3}:null},tr:a=>(a=a.closest("table"))&&C(a)?{conversion:D,priority:3}:null}}static importJSON(a){let b=E(a.language);b.setFormat(a.format);
b.setIndent(a.indent);b.setDirection(a.direction);return b}exportJSON(){return{...super.exportJSON(),language:this.getLanguage()}}insertNewAfter(a,b=!0){var c=this.getChildren(),e=c.length;if(2<=e&&"\n"===c[e-1].getTextContent()&&"\n"===c[e-2].getTextContent()&&a.isCollapsed()&&a.anchor.key===this.__key&&a.anchor.offset===e)return c[e-1].remove(),c[e-2].remove(),a=m.$createParagraphNode(),this.insertAfter(a,b),a;let {anchor:f,focus:g}=a;b=(f.isBefore(g)?f:g).getNode();if(m.$isTextNode(b)){e=F(b);
for(c=[];;)if(m.$isTabNode(e))c.push(m.$createTabNode()),e=e.getNextSibling();else if(G(e)){for(var h=0,k=e.getTextContent(),l=e.getTextContentSize();h<l&&" "===k[h];)h++;0!==h&&c.push(H(" ".repeat(h)));if(h!==l)break;e=e.getNextSibling()}else break;e=b.splitText(f.offset)[0];h=0===f.offset?0:1;h=e.getIndexWithinParent()+h;k=b.getParentOrThrow();l=[m.$createLineBreakNode(),...c];k.splice(h,0,l);(c=c[c.length-1])?c.select():0===f.offset?e.selectPrevious():e.getNextSibling().selectNext(0,0)}I(b)&&({offset:a}=
a.anchor,b.splice(a,0,[m.$createLineBreakNode()]),b.select(a+1,a+1));return null}canIndent(){return!1}collapseAtStart(){let a=m.$createParagraphNode();this.getChildren().forEach(b=>a.append(b));this.replace(a);return!0}setLanguage(a){let b=this.getWritable();b.__language=a;b.__isSyntaxHighlightSupported=y(a)}getLanguage(){return this.getLatest().__language}getIsSyntaxHighlightSupported(){return this.getLatest().__isSyntaxHighlightSupported}}function E(a){return m.$applyNodeReplacement(new A(a))}
function I(a){return a instanceof A}function B(a){a=a.getAttribute("data-language");return{node:E(a)}}function aa(a){let b=null!==a.style.fontFamily.match("monospace");var c;if(c=!b){a:{for(a=a.parentElement;null!==a;){if(null!==a.style.fontFamily.match("monospace")){a=!0;break a}a=a.parentElement}a=!1}c=!a}return c?{node:null}:{node:b?E():null}}function ba(){return{node:E()}}function D(){return{node:null}}function C(a){return a.classList.contains("js-file-line-container")}
let J={c:"C",clike:"C-like",cpp:"C++",css:"CSS",html:"HTML",java:"Java",js:"JavaScript",markdown:"Markdown",objc:"Objective-C",plain:"Plain Text",powershell:"PowerShell",py:"Python",rust:"Rust",sql:"SQL",swift:"Swift",typescript:"TypeScript",xml:"XML"},K={cpp:"cpp",java:"java",javascript:"js",md:"markdown",plaintext:"plain",python:"py",text:"plain",ts:"typescript"};function M(a){return K[a]||a}
class N extends m.TextNode{constructor(a,b,c){super(a,c);this.__highlightType=b}static getType(){return"code-highlight"}static clone(a){return new N(a.__text,a.__highlightType||void 0,a.__key)}getHighlightType(){return this.getLatest().__highlightType}canHaveFormat(){return!1}createDOM(a){let b=super.createDOM(a);a=O(a.theme,this.__highlightType);d.addClassNamesToElement(b,a);return b}updateDOM(a,b,c){let e=super.updateDOM(a,b,c);a=O(c.theme,a.__highlightType);c=O(c.theme,this.__highlightType);a!==
c&&(a&&d.removeClassNamesFromElement(b,a),c&&d.addClassNamesToElement(b,c));return e}static importJSON(a){let b=H(a.text,a.highlightType);b.setFormat(a.format);b.setDetail(a.detail);b.setMode(a.mode);b.setStyle(a.style);return b}exportJSON(){return{...super.exportJSON(),highlightType:this.getHighlightType()}}setFormat(){return this}isParentRequired(){return!0}createParentElementNode(){return E()}}function O(a,b){return b&&a&&a.codeHighlight&&a.codeHighlight[b]}
function H(a,b){return m.$applyNodeReplacement(new N(a,b))}function G(a){return a instanceof N}function F(a){let b=a;for(;G(a)||m.$isTabNode(a);)b=a,a=a.getPreviousSibling();return b}function P(a){let b=a;for(;G(a)||m.$isTabNode(a);)b=a,a=a.getNextSibling();return b}let Q={defaultLanguage:"javascript",tokenize(a,b){return x.tokenize(a,x.languages[b||""]||x.languages[this.defaultLanguage])}};
function R(a,b){let c=null;var e=null,f=a;let g=b,h=a.getTextContent();for(;;){if(0===g){f=f.getPreviousSibling();if(null===f)break;G(f)||m.$isTabNode(f)||m.$isLineBreakNode(f)||q(167);if(m.$isLineBreakNode(f)){c={node:f,offset:1};break}g=Math.max(0,f.getTextContentSize()-1);h=f.getTextContent()}else g--;let k=h[g];G(f)&&" "!==k&&(e={node:f,offset:g})}if(null!==e)return e;e=null;b<a.getTextContentSize()?G(a)&&(e=a.getTextContent()[b]):(f=a.getNextSibling(),G(f)&&(e=f.getTextContent()[0]));if(null!==
e&&" "!==e)return c;a:for(e=a,f=a.getTextContent(),a=a.getTextContentSize();;){if(!G(e)||b===a){e=e.getNextSibling();if(null===e||m.$isLineBreakNode(e)){a=null;break a}G(e)&&(b=0,f=e.getTextContent(),a=e.getTextContentSize())}if(G(e)){if(" "!==f[b]){a={node:e,offset:b};break a}b++}}return null!==a?a:c}function S(a){a=P(a);m.$isLineBreakNode(a)&&q(168);return a}function T(a,b,c){let e=a.getParent();I(e)?U(e,b,c):G(a)&&a.replace(m.$createTextNode(a.__text))}let V=new Set;
function U(a,b,c){let e=a.getKey();V.has(e)||(V.add(e),void 0===a.getLanguage()&&a.setLanguage(c.defaultLanguage),b.update(()=>{ca(e,()=>{var f=m.$getNodeByKey(e);if(!I(f)||!f.isAttached())return!1;var g=f.getTextContent();g=c.tokenize(g,f.getLanguage()||c.defaultLanguage);g=W(g);var h=f.getChildren();for(f=0;f<h.length&&X(h[f],g[f]);)f++;var k=h.length;let l=g.length,r=Math.min(k,l)-f,n=0;for(;n<r;)if(n++,!X(h[k-n],g[l-n])){n--;break}h=f;k-=n;g=g.slice(f,l-n);let {from:p,to:w,nodesForReplacement:u}=
{from:h,nodesForReplacement:g,to:k};return p!==w||u.length?(a.splice(p,w-p,u),!0):!1})},{onUpdate:()=>{V.delete(e)},skipTransforms:!0}))}
function W(a,b){let c=[];for(let e of a)if("string"===typeof e){a=e.split(/(\n|\t)/);let f=a.length;for(let g=0;g<f;g++){let h=a[g];"\n"===h||"\r\n"===h?c.push(m.$createLineBreakNode()):"\t"===h?c.push(m.$createTabNode()):0<h.length&&c.push(H(h,b))}}else({content:a}=e),"string"===typeof a?c.push(...W([a],e.type)):Array.isArray(a)&&c.push(...W(a,e.type));return c}
function ca(a,b){a=m.$getNodeByKey(a);if(I(a)&&a.isAttached()){var c=m.$getSelection();if(m.$isRangeSelection(c)){c=c.anchor;var e=c.offset,f="element"===c.type&&m.$isLineBreakNode(a.getChildAtIndex(c.offset-1)),g=0;if(!f){let h=c.getNode();g=e+h.getPreviousSiblings().reduce((k,l)=>k+l.getTextContentSize(),0)}b()&&(f?c.getNode().select(e,e):a.getChildren().some(h=>{let k=m.$isTextNode(h);if(k||m.$isLineBreakNode(h)){let l=h.getTextContentSize();if(k&&l>=g)return h.select(g,g),!0;g-=l}return!1}))}else b()}}
function X(a,b){return G(a)&&G(b)&&a.__text===b.__text&&a.__highlightType===b.__highlightType||m.$isTabNode(a)&&m.$isTabNode(b)||m.$isLineBreakNode(a)&&m.$isLineBreakNode(b)}function Y(a){if(!m.$isRangeSelection(a))return!1;var b=a.anchor.getNode();a=a.focus.getNode();if(b.is(a)&&I(b))return!0;b=b.getParent();return I(b)&&b.is(a.getParent())}
function Z(a){a=a.getNodes();let b=[[]];if(1===a.length&&I(a[0]))return b;let c=b[0];for(let e=0;e<a.length;e++){let f=a[e];G(f)||m.$isTabNode(f)||m.$isLineBreakNode(f)||q(169);m.$isLineBreakNode(f)?0!==e&&0<c.length&&(c=[],b.push(c)):c.push(f)}return b}
function da(a){var b=m.$getSelection();if(!m.$isRangeSelection(b)||!Y(b))return null;let c=a?m.OUTDENT_CONTENT_COMMAND:m.INDENT_CONTENT_COMMAND;a=a?m.OUTDENT_CONTENT_COMMAND:m.INSERT_TAB_COMMAND;if(1<Z(b).length)return c;var e=b.getNodes()[0];I(e)||G(e)||m.$isTabNode(e)||m.$isLineBreakNode(e)||q(170);if(I(e))return c;let f=F(e);e=P(e);var g=b.anchor;let h=b.focus;h.isBefore(g)?b=h:(b=g,g=h);return null!==f&&null!==e&&b.key===f.getKey()&&0===b.offset&&g.key===e.getKey()&&g.offset===e.getTextContentSize()?
c:a}
function ea(a){var b=m.$getSelection();if(!m.$isRangeSelection(b)||!Y(b))return!1;var c=Z(b);let e=c.length;if(1<c.length){for(b=0;b<e;b++){var f=c[b];0<f.length&&(f=f[0],0===b&&(f=F(f)),null!==f&&(a===m.INDENT_CONTENT_COMMAND?f.insertBefore(m.$createTabNode()):m.$isTabNode(f)&&f.remove()))}return!0}c=b.getNodes()[0];I(c)||G(c)||m.$isTabNode(c)||m.$isLineBreakNode(c)||q(171);if(I(c))return a===m.INDENT_CONTENT_COMMAND&&b.insertNodes([m.$createTabNode()]),!0;c=F(c);null===c&&q(172);a===m.INDENT_CONTENT_COMMAND?m.$isLineBreakNode(c)?
c.insertAfter(m.$createTabNode()):c.insertBefore(m.$createTabNode()):m.$isTabNode(c)&&c.remove();return!0}
function fa(a,b){let c=m.$getSelection();if(!m.$isRangeSelection(c))return!1;let {anchor:e,focus:f}=c,g=e.offset,h=f.offset,k=e.getNode(),l=f.getNode();var r=a===m.KEY_ARROW_UP_COMMAND;if(!Y(c)||!G(k)&&!m.$isTabNode(k)||!G(l)&&!m.$isTabNode(l))return!1;if(!b.altKey){if(c.isCollapsed())if(a=k.getParentOrThrow(),r&&0===g&&null===k.getPreviousSibling()){if(null===a.getPreviousSibling())return a.selectPrevious(),b.preventDefault(),!0}else if(!r&&g===k.getTextContentSize()&&null===k.getNextSibling()&&
null===a.getNextSibling())return a.selectNext(),b.preventDefault(),!0;return!1}let n;if(k.isBefore(l)){var p=F(k);n=P(l)}else p=F(l),n=P(k);if(null==p||null==n)return!1;let w=p.getNodesBetween(n);for(let t=0;t<w.length;t++){let L=w[t];if(!G(L)&&!m.$isTabNode(L)&&!m.$isLineBreakNode(L))return!1}b.preventDefault();b.stopPropagation();b=r?p.getPreviousSibling():n.getNextSibling();if(!m.$isLineBreakNode(b))return!0;p=r?b.getPreviousSibling():b.getNextSibling();if(null==p)return!0;r=G(p)||m.$isTabNode(p)||
m.$isLineBreakNode(p)?r?F(p):P(p):null;let u=null!=r?r:p;b.remove();w.forEach(t=>t.remove());a===m.KEY_ARROW_UP_COMMAND?(w.forEach(t=>u.insertBefore(t)),u.insertBefore(b)):(u.insertAfter(b),u=b,w.forEach(t=>{u.insertAfter(t);u=t}));c.setTextNodeRange(k,g,l,h);return!0}
function ha(a,b){let c=m.$getSelection();if(!m.$isRangeSelection(c))return!1;let {anchor:e,focus:f}=c;var g=e.getNode();let h=f.getNode();a=a===m.MOVE_TO_START;if(!Y(c)||!G(g)&&!m.$isTabNode(g)||!G(h)&&!m.$isTabNode(h))return!1;if(a)if(g=R(h,f.offset),null!==g){let {node:k,offset:l}=g;m.$isLineBreakNode(k)?k.selectNext(0,0):c.setTextNodeRange(k,l,k,l)}else h.getParentOrThrow().selectStart();else S(h).select();b.preventDefault();b.stopPropagation();return!0}exports.$createCodeHighlightNode=H;
exports.$createCodeNode=E;exports.$isCodeHighlightNode=G;exports.$isCodeNode=I;exports.CODE_LANGUAGE_FRIENDLY_NAME_MAP=J;exports.CODE_LANGUAGE_MAP=K;exports.CodeHighlightNode=N;exports.CodeNode=A;exports.DEFAULT_CODE_LANGUAGE="javascript";exports.PrismTokenizer=Q;exports.getCodeLanguages=()=>Object.keys(x.languages).filter(a=>"function"!==typeof x.languages[a]).sort();exports.getDefaultCodeLanguage=()=>"javascript";exports.getEndOfCodeInLine=S;exports.getFirstCodeNodeOfLine=F;
exports.getLanguageFriendlyName=function(a){a=M(a);return J[a]||a};exports.getLastCodeNodeOfLine=P;exports.getStartOfCodeInLine=R;exports.normalizeCodeLang=M;
exports.registerCodeHighlighting=function(a,b){if(!a.hasNodes([A,N]))throw Error("CodeHighlightPlugin: CodeNode or CodeHighlightNode not registered on editor");null==b&&(b=Q);return d.mergeRegister(a.registerMutationListener(A,c=>{a.update(()=>{for(let [g,h]of c)if("destroyed"!==h){var e=m.$getNodeByKey(g);if(null!==e)a:{var f=e;e=a.getElementByKey(f.getKey());if(null===e)break a;f=f.getChildren();let k=f.length;if(k===e.__cachedChildrenLength)break a;e.__cachedChildrenLength=k;let l="1",r=1;for(let n=
0;n<k;n++)m.$isLineBreakNode(f[n])&&(l+="\n"+ ++r);e.setAttribute("data-gutter",l)}}})},{skipInitialization:!1}),a.registerNodeTransform(A,c=>U(c,a,b)),a.registerNodeTransform(m.TextNode,c=>T(c,a,b)),a.registerNodeTransform(N,c=>T(c,a,b)),a.registerCommand(m.KEY_TAB_COMMAND,c=>{let e=da(c.shiftKey);if(null===e)return!1;c.preventDefault();a.dispatchCommand(e,void 0);return!0},m.COMMAND_PRIORITY_LOW),a.registerCommand(m.INSERT_TAB_COMMAND,()=>{let c=m.$getSelection();if(!Y(c))return!1;m.$insertNodes([m.$createTabNode()]);
return!0},m.COMMAND_PRIORITY_LOW),a.registerCommand(m.INDENT_CONTENT_COMMAND,()=>ea(m.INDENT_CONTENT_COMMAND),m.COMMAND_PRIORITY_LOW),a.registerCommand(m.OUTDENT_CONTENT_COMMAND,()=>ea(m.OUTDENT_CONTENT_COMMAND),m.COMMAND_PRIORITY_LOW),a.registerCommand(m.KEY_ARROW_UP_COMMAND,c=>fa(m.KEY_ARROW_UP_COMMAND,c),m.COMMAND_PRIORITY_LOW),a.registerCommand(m.KEY_ARROW_DOWN_COMMAND,c=>fa(m.KEY_ARROW_DOWN_COMMAND,c),m.COMMAND_PRIORITY_LOW),a.registerCommand(m.MOVE_TO_END,c=>ha(m.MOVE_TO_END,c),m.COMMAND_PRIORITY_LOW),
a.registerCommand(m.MOVE_TO_START,c=>ha(m.MOVE_TO_START,c),m.COMMAND_PRIORITY_LOW))}
