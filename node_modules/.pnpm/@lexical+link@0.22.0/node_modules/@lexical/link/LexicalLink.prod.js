/**
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 */

'use strict';var f=require("@lexical/utils"),m=require("lexical"),n;function p(a){let b=new URLSearchParams;b.append("code",a);for(let c=1;c<arguments.length;c++)b.append("v",arguments[c]);throw Error(`Minified Lexical error #${a}; visit https://lexical.dev/docs/error?${b} for the full message or `+"use the non-minified dev environment for full errors and additional helpful warnings.");}n=p&&p.__esModule&&Object.prototype.hasOwnProperty.call(p,"default")?p["default"]:p;
let q=new Set(["http:","https:","mailto:","sms:","tel:"]);
class r extends m.ElementNode{static getType(){return"link"}static clone(a){return new r(a.__url,{rel:a.__rel,target:a.__target,title:a.__title},a.__key)}constructor(a,b={},c){super(c);let {target:g=null,rel:h=null,title:k=null}=b;this.__url=a;this.__target=g;this.__rel=h;this.__title=k}createDOM(a){let b=document.createElement("a");b.href=this.sanitizeUrl(this.__url);null!==this.__target&&(b.target=this.__target);null!==this.__rel&&(b.rel=this.__rel);null!==this.__title&&(b.title=this.__title);f.addClassNamesToElement(b,
a.theme.link);return b}updateDOM(a,b){if(f.isHTMLAnchorElement(b)){let c=this.__url,g=this.__target,h=this.__rel,k=this.__title;c!==a.__url&&(b.href=c);g!==a.__target&&(g?b.target=g:b.removeAttribute("target"));h!==a.__rel&&(h?b.rel=h:b.removeAttribute("rel"));k!==a.__title&&(k?b.title=k:b.removeAttribute("title"))}return!1}static importDOM(){return{a:()=>({conversion:t,priority:1})}}static importJSON(a){let b=u(a.url,{rel:a.rel,target:a.target,title:a.title});b.setFormat(a.format);b.setIndent(a.indent);
b.setDirection(a.direction);return b}sanitizeUrl(a){try{let b=new URL(a);if(!q.has(b.protocol))return"about:blank"}catch(b){}return a}exportJSON(){return{...super.exportJSON(),rel:this.getRel(),target:this.getTarget(),title:this.getTitle(),url:this.getURL()}}getURL(){return this.getLatest().__url}setURL(a){this.getWritable().__url=a}getTarget(){return this.getLatest().__target}setTarget(a){this.getWritable().__target=a}getRel(){return this.getLatest().__rel}setRel(a){this.getWritable().__rel=a}getTitle(){return this.getLatest().__title}setTitle(a){this.getWritable().__title=
a}insertNewAfter(a,b=!0){a=u(this.__url,{rel:this.__rel,target:this.__target,title:this.__title});this.insertAfter(a,b);return a}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}canBeEmpty(){return!1}isInline(){return!0}extractWithChild(a,b){if(!m.$isRangeSelection(b))return!1;a=b.anchor.getNode();let c=b.focus.getNode();return this.isParentOf(a)&&this.isParentOf(c)&&0<b.getTextContent().length}isEmailURI(){return this.__url.startsWith("mailto:")}isWebSiteURI(){return this.__url.startsWith("https://")||
this.__url.startsWith("http://")}}function t(a){let b=null;if(f.isHTMLAnchorElement(a)){let c=a.textContent;if(null!==c&&""!==c||0<a.children.length)b=u(a.getAttribute("href")||"",{rel:a.getAttribute("rel"),target:a.getAttribute("target"),title:a.getAttribute("title")})}return{node:b}}function u(a,b){return m.$applyNodeReplacement(new r(a,b))}function v(a){return a instanceof r}
class x extends r{constructor(a,b={},c){super(a,b,c);this.__isUnlinked=void 0!==b.isUnlinked&&null!==b.isUnlinked?b.isUnlinked:!1}static getType(){return"autolink"}static clone(a){return new x(a.__url,{isUnlinked:a.__isUnlinked,rel:a.__rel,target:a.__target,title:a.__title},a.__key)}getIsUnlinked(){return this.__isUnlinked}setIsUnlinked(a){let b=this.getWritable();b.__isUnlinked=a;return b}createDOM(a){return this.__isUnlinked?document.createElement("span"):super.createDOM(a)}updateDOM(a,b,c){return super.updateDOM(a,
b,c)||a.__isUnlinked!==this.__isUnlinked}static importJSON(a){let b=y(a.url,{isUnlinked:a.isUnlinked,rel:a.rel,target:a.target,title:a.title});b.setFormat(a.format);b.setIndent(a.indent);b.setDirection(a.direction);return b}static importDOM(){return null}exportJSON(){return{...super.exportJSON(),isUnlinked:this.__isUnlinked}}insertNewAfter(a,b=!0){a=this.getParentOrThrow().insertNewAfter(a,b);return m.$isElementNode(a)?(b=y(this.__url,{isUnlinked:this.__isUnlinked,rel:this.__rel,target:this.__target,
title:this.__title}),a.append(b),b):null}}function y(a,b){return m.$applyNodeReplacement(new x(a,b))}function z(a){return a instanceof x}let B=m.createCommand("TOGGLE_LINK_COMMAND");function C(a,b){if("element"===a.type){let c=a.getNode();m.$isElementNode(c)||n(252);return c.getChildren()[a.offset+b]||null}return null}
function D(a){var b=m.$getSelection();if(!m.$isRangeSelection(b))return a();var c=m.$normalizeSelection__EXPERIMENTAL(b);b=c.isBackward();var g=C(c.anchor,b?-1:0);c=C(c.focus,b?0:-1);a=a();if(g||c){var h=m.$getSelection();if(m.$isRangeSelection(h)){h=h.clone();if(g){let k=g.getParent();k&&h.anchor.set(k.getKey(),g.getIndexWithinParent()+(b?1:0),"element")}c&&(g=c.getParent())&&h.focus.set(g.getKey(),c.getIndexWithinParent()+(b?0:1),"element");m.$setSelection(m.$normalizeSelection__EXPERIMENTAL(h))}}return a}
function E(a,b={}){let {target:c,title:g}=b,h=void 0===b.rel?"noreferrer":b.rel;b=m.$getSelection();if(m.$isRangeSelection(b)){var k=b.extract();if(null===a)k.forEach(d=>{if(d=f.$findMatchingParent(d,l=>!z(l)&&v(l))){let l=d.getChildren();for(let e=0;e<l.length;e++)d.insertBefore(l[e]);d.remove()}});else{var A=new Set,w=d=>{A.has(d.getKey())||(A.add(d.getKey()),d.setURL(a),void 0!==c&&d.setTarget(c),void 0!==h&&d.setRel(h),void 0!==g&&d.setTitle(g))};if(1===k.length&&(b=F(k[0],v),null!==b))return w(b);
D(()=>{let d=null;for(let e of k)if(e.isAttached()){var l=F(e,v);if(l)w(l);else{if(m.$isElementNode(e)){if(!e.isInline())continue;if(v(e)){if(!(z(e)||null!==d&&d.getParentOrThrow().isParentOf(e))){w(e);d=e;continue}for(let G of e.getChildren())e.insertBefore(G);e.remove();continue}}l=e.getPreviousSibling();v(l)&&l.is(d)?l.append(e):(d=u(a,{rel:h,target:c,title:g}),e.insertAfter(d),d.append(e))}}})}}}
function F(a,b){for(;null!==a&&null!==a.getParent()&&!b(a);)a=a.getParentOrThrow();return b(a)?a:null}exports.$createAutoLinkNode=y;exports.$createLinkNode=u;exports.$isAutoLinkNode=z;exports.$isLinkNode=v;exports.$toggleLink=E;exports.AutoLinkNode=x;exports.LinkNode=r;exports.TOGGLE_LINK_COMMAND=B;exports.toggleLink=E
