/**
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 */

'use strict';var p=require("lexical"),z=require("@lexical/list"),E=require("@lexical/rich-text"),aa=require("@lexical/utils"),F=require("@lexical/code"),G=require("@lexical/link");function I(a,c){let b={};for(let e of a)(a=c(e))&&(b[a]?b[a].push(e):b[a]=[e]);return b}function J(a){a=I(a,c=>c.type);return{element:a.element||[],multilineElement:a["multiline-element"]||[],textFormat:a["text-format"]||[],textMatch:a["text-match"]||[]}}let K=/[!-/:-@[-`{-~\s]/,ba=/^\s{0,3}$/;
function L(a){if(!p.$isParagraphNode(a))return!1;let c=a.getFirstChild();return null==c||1===a.getChildrenSize()&&p.$isTextNode(c)&&ba.test(c.getTextContent())}function ca(a,c=!1){let b=J(a),e=[...b.multilineElement,...b.element],f=!c,d=b.textFormat.filter(g=>1===g.format.length);return g=>{let n=[];g=(g||p.$getRoot()).getChildren();for(let h=0;h<g.length;h++){let r=g[h],x=da(r,e,d,b.textMatch);null!=x&&n.push(f&&0<h&&!L(r)&&!L(g[h-1])?"\n".concat(x):x)}return n.join("\n")}}
function da(a,c,b,e){for(let f of c)if(f.export&&(c=f.export(a,d=>M(d,b,e)),null!=c))return c;return p.$isElementNode(a)?M(a,b,e):p.$isDecoratorNode(a)?a.getTextContent():null}
function M(a,c,b){let e=[];a=a.getChildren();let f=[];a:for(let d of a){for(let g of b)if(g.export&&(a=g.export(d,n=>M(n,c,b),(n,h)=>N(n,h,c,f)),null!=a)){e.push(a);continue a}p.$isLineBreakNode(d)?e.push("\n"):p.$isTextNode(d)?e.push(N(d,d.getTextContent(),c,f)):p.$isElementNode(d)?e.push(M(d,c,b)):p.$isDecoratorNode(d)&&e.push(d.getTextContent())}return e.join("")}
function N(a,c,b,e){let f=c.trim(),d=f,g="",n="",h=O(a,!0);var r=O(a,!1);let x=new Set;for(let w of b){b=w.format[0];let q=w.tag;P(a,b)&&!x.has(b)&&(x.add(b),P(h,b)&&e.find(l=>l.tag===q)||(e.push({format:b,tag:q}),g+=q))}for(a=0;a<e.length;a++)if(!P(r,e[a].format)){for(;e.length>a;)(r=e.pop())&&"string"===typeof r.tag&&(n+=r.tag);break}d=g+d+n;return c.replace(f,()=>d)}
function O(a,c){let b=c?a.getPreviousSibling():a.getNextSibling();b||(a=a.getParentOrThrow(),a.isInline()&&(b=c?a.getPreviousSibling():a.getNextSibling()));for(;b;){if(p.$isElementNode(b)){if(!b.isInline())break;a=c?b.getLastDescendant():b.getFirstDescendant();if(p.$isTextNode(a))return a;b=c?b.getPreviousSibling():b.getNextSibling()}if(p.$isTextNode(b))return b;if(!p.$isElementNode(b))break}return null}function P(a,c){return p.$isTextNode(a)&&a.hasFormat(c)}
let Q="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement,ea=Q&&"documentMode"in document?document.documentMode:null;Q&&"InputEvent"in window&&!ea?"getTargetRanges"in new window.InputEvent("input"):!1;
let R=Q&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent),S=Q&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,fa=Q&&/^(?=.*Chrome).*/i.test(navigator.userAgent),T=Q&&/AppleWebKit\/[\d.]+/.test(navigator.userAgent)&&!fa;
function ha(a,c=!1){let b=J(a),e=ia(b.textFormat);return(f,d)=>{f=f.split("\n");let g=f.length;d=d||p.$getRoot();d.clear();for(let u=0;u<g;u++){var n=f[u];a:{var h=f;var r=u,x=b.multilineElement,w=d;for(var q of x){let {handleImportAfterStartMatch:B,regExpEnd:y,regExpStart:A,replace:H}=q;if(x=h[r].match(A)){if(B){var l=B({lines:h,rootNode:w,startLineIndex:r,startMatch:x,transformer:q});if(null===l)continue;else if(l){h=l;break a}}var m="object"===typeof y&&"regExp"in y?y.regExp:y,k=y&&"object"===
typeof y&&"optional"in y?y.optional:!y;l=r;for(var t=h.length;l<t;){var v=m?h[l].match(m):null;if(v||k&&!(k&&l<t-1))if(v&&r===l&&v.index===x.index)l++;else{m=[];if(v&&r===l)m.push(h[r].slice(x[0].length,-v[0].length));else for(k=r;k<=l;k++)k===r?(t=h[k].slice(x[0].length),m.push(t)):k===l&&v?(t=h[k].slice(0,-v[0].length),m.push(t)):m.push(h[k]);if(!1!==H(w,null,x,v,m,!0)){h=[!0,l];break a}break}else l++}}}h=[!1,r]}let [D,C]=h;if(D)u=C;else{h=n;l=d;v=b.element;r=e;w=b.textMatch;x=p.$createTextNode(h);
n=p.$createParagraphNode();n.append(x);l.append(n);for(let {regExp:B,replace:y}of v)if(l=h.match(B))if(x.setTextContent(h.slice(l[0].length)),!1!==y(n,[x],l,!0))break;U(x,r,w);n.isAttached()&&0<h.length&&(h=n.getPreviousSibling(),p.$isParagraphNode(h)||E.$isQuoteNode(h)||z.$isListNode(h))&&(r=h,z.$isListNode(h)&&(h=h.getLastDescendant(),r=null==h?null:aa.$findMatchingParent(h,z.$isListItemNode)),null!=r&&0<r.getTextContentSize()&&(r.splice(r.getChildrenSize(),0,[p.$createLineBreakNode(),...n.getChildren()]),
n.remove()))}}q=d.getChildren();for(let u of q)!c&&L(u)&&1<d.getChildrenSize()&&u.remove();null!==p.$getSelection()&&d.selectStart()}}function U(a,c,b){var e=a.getTextContent();let f=ja(e,c);if(f){var d,g;if(f[0]===e)var n=a;else{e=f.index||0;let h=e+f[0].length;0===e?[n,d]=a.splitText(h):[g,n,d]=a.splitText(e,h)}n.setTextContent(f[2]);if(a=c.transformersByTag[f[1]])for(let h of a.format)n.hasFormat(h)||n.toggleFormat(h);n.hasFormat("code")||U(n,c,b);g&&U(g,c,b);d&&U(d,c,b)}else ka(a,b)}
function ka(a,c){a:for(;a;){for(let b of c){if(!b.replace||!b.importRegExp)continue;let e=a.getTextContent().match(b.importRegExp);if(!e)continue;let f=e.index||0,d=b.getEndIndex?b.getEndIndex(a,e):f+e[0].length;if(!1===d)continue;let g,n;0===f?[g,a]=a.splitText(d):[,g,n]=a.splitText(f,d);n&&ka(n,c);b.replace(g,e);continue a}break}}
function ja(a,c){var b=a.match(c.openTagsRegExp);if(null==b)return null;for(let d of b){var e=d.replace(/^\s/,"");b=c.fullMatchRegExpByTag[e];if(null!=b&&(b=a.match(b),e=c.transformersByTag[e],null!=b&&null!=e)){if(!1!==e.intraword)return b;var {index:f=0}=b;e=a[f-1];f=a[f+b[0].length];if(!(e&&!K.test(e)||f&&!K.test(f)))return b}}return null}
function ia(a){let c={},b={},e=[];for(let f of a){({tag:a}=f);c[a]=f;let d=a.replace(/(\*|\^|\+)/g,"\\$1");e.push(d);b[a]=R||S||T?new RegExp(`(${d})(?![${d}\\s])(.*?[^${d}\\s])${d}(?!${d})`):new RegExp(`(?<![\\\\${d}])(${d})((\\\\${d})?.*?[^${d}\\s](\\\\${d})?)((?<!\\\\)|(?<=\\\\\\\\))(${d})(?![\\\\${d}])`)}return{fullMatchRegExpByTag:b,openTagsRegExp:new RegExp((R||S||T?"":"(?<![\\\\])")+"("+e.join("|")+")","g"),transformersByTag:c}}var la;
function V(a){let c=new URLSearchParams;c.append("code",a);for(let b=1;b<arguments.length;b++)c.append("v",arguments[b]);throw Error(`Minified Lexical error #${a}; visit https://lexical.dev/docs/error?${c} for the full message or `+"use the non-minified dev environment for full errors and additional helpful warnings.");}la=V&&V.__esModule&&Object.prototype.hasOwnProperty.call(V,"default")?V["default"]:V;
function ma(a,c,b){let e=b.length;for(;c>=e;c--){let f=c-e;if(na(a,f,b,0,e)&&" "!==a[f+e])return f}return-1}function na(a,c,b,e,f){for(let d=0;d<f;d++)if(a[c+d]!==b[e+d])return!1;return!0}
let oa=/^(\s*)(\d{1,})\.\s/,pa=/^(\s*)[-*+]\s/,qa=/^(\s*)(?:-\s)?\s?(\[(\s|x)?\])\s/i,W=/^(#{1,6})\s/,ra=/^>\s/,sa=/^[ \t]*```(\w+)?/,ta=/[ \t]*```$/,ua=/^[ \t]*```[^`]+(?:(?:`{1,2}|`{4,})[^`]+)*```(?:[^`]|$)/,va=/^(?:\|)(.+)(?:\|)\s?$/,wa=/^(\| ?:?-*:? ?)+\|\s?$/,xa=a=>(c,b,e)=>{e=a(e);e.append(...b);c.replace(e);e.select(0,0)},X=a=>(c,b,e)=>{var f=c.getPreviousSibling(),d=c.getNextSibling();const g=z.$createListItemNode("check"===a?"x"===e[3]:void 0);z.$isListNode(d)&&d.getListType()===a?(f=d.getFirstChild(),
null!==f?f.insertBefore(g):d.append(g),c.remove()):z.$isListNode(f)&&f.getListType()===a?(f.append(g),c.remove()):(d=z.$createListNode(a,"number"===a?Number(e[2]):void 0),d.append(g),c.replace(d));g.append(...b);g.select(0,0);b=e[1];c=b.match(/\t/g);b=b.match(/ /g);e=0;c&&(e+=c.length);b&&(e+=Math.floor(b.length/4));(c=e)&&g.setIndent(c)},Y=(a,c,b)=>{const e=[];var f=a.getChildren();let d=0;for(const n of f)if(z.$isListItemNode(n)){if(1===n.getChildrenSize()&&(f=n.getFirstChild(),z.$isListNode(f))){e.push(Y(f,
c,b+1));continue}f=" ".repeat(4*b);var g=a.getListType();g="number"===g?`${a.getStart()+d}. `:"check"===g?`- [${n.getChecked()?"x":" "}] `:"- ";e.push(f+g+c(n));d++}return e.join("\n")},ya={dependencies:[E.HeadingNode],export:(a,c)=>{if(!E.$isHeadingNode(a))return null;const b=Number(a.getTag().slice(1));return"#".repeat(b)+" "+c(a)},regExp:W,replace:xa(a=>E.$createHeadingNode("h"+a[1].length)),type:"element"},za={dependencies:[E.QuoteNode],export:(a,c)=>{if(!E.$isQuoteNode(a))return null;a=c(a).split("\n");
c=[];for(const b of a)c.push("> "+b);return c.join("\n")},regExp:ra,replace:(a,c,b,e)=>{if(e&&(b=a.getPreviousSibling(),E.$isQuoteNode(b))){b.splice(b.getChildrenSize(),0,[p.$createLineBreakNode(),...c]);b.select(0,0);a.remove();return}b=E.$createQuoteNode();b.append(...c);a.replace(b);b.select(0,0)},type:"element"},Aa={dependencies:[F.CodeNode],export:a=>{if(!F.$isCodeNode(a))return null;const c=a.getTextContent();return"```"+(a.getLanguage()||"")+(c?"\n"+c:"")+"\n```"},regExpEnd:{optional:!0,regExp:ta},
regExpStart:sa,replace:(a,c,b,e,f,d)=>{if(!c&&f){if(1===f.length)e?(c=F.$createCodeNode(),b=b[1]+f[0]):(c=F.$createCodeNode(b[1]),b=f[0].startsWith(" ")?f[0].slice(1):f[0]);else{c=F.$createCodeNode(b[1]);if(0===f[0].trim().length)for(;0<f.length&&!f[0].length;)f.shift();else f[0]=f[0].startsWith(" ")?f[0].slice(1):f[0];for(;0<f.length&&!f[f.length-1].length;)f.pop();b=f.join("\n")}b=p.$createTextNode(b);c.append(b);a.append(c)}else c&&xa(g=>F.$createCodeNode(g?g[1]:void 0))(a,c,b,d)},type:"multiline-element"},
Ba={dependencies:[z.ListNode,z.ListItemNode],export:(a,c)=>z.$isListNode(a)?Y(a,c,0):null,regExp:pa,replace:X("bullet"),type:"element"},Ca={dependencies:[z.ListNode,z.ListItemNode],export:(a,c)=>z.$isListNode(a)?Y(a,c,0):null,regExp:qa,replace:X("check"),type:"element"},Da={dependencies:[z.ListNode,z.ListItemNode],export:(a,c)=>z.$isListNode(a)?Y(a,c,0):null,regExp:oa,replace:X("number"),type:"element"},Ea={format:["code"],tag:"`",type:"text-format"},Ga={format:["highlight"],tag:"==",type:"text-format"},
Ha={format:["bold","italic"],tag:"***",type:"text-format"},Ia={format:["bold","italic"],intraword:!1,tag:"___",type:"text-format"},Ja={format:["bold"],tag:"**",type:"text-format"},Ka={format:["bold"],intraword:!1,tag:"__",type:"text-format"},La={format:["strikethrough"],tag:"~~",type:"text-format"},Ma={format:["italic"],tag:"*",type:"text-format"},Na={format:["italic"],intraword:!1,tag:"_",type:"text-format"},Oa={dependencies:[G.LinkNode],export:(a,c,b)=>{if(!G.$isLinkNode(a))return null;c=(c=a.getTitle())?
`[${a.getTextContent()}](${a.getURL()} "${c}")`:`[${a.getTextContent()}](${a.getURL()})`;const e=a.getFirstChild();return 1===a.getChildrenSize()&&p.$isTextNode(e)?b(e,c):c},importRegExp:/(?:\[([^[]+)\])(?:\((?:([^()\s]+)(?:\s"((?:[^"]*\\")*[^"]*)"\s*)?)\))/,regExp:/(?:\[([^[]+)\])(?:\((?:([^()\s]+)(?:\s"((?:[^"]*\\")*[^"]*)"\s*)?)\))$/,replace:(a,c)=>{const [,b,e,f]=c;c=G.$createLinkNode(e,{title:f});const d=p.$createTextNode(b);d.setFormat(a.getFormat());c.append(d);a.replace(c)},trigger:")",type:"text-match"};
function Pa(a,c=!1){a=a.split("\n");let b=!1,e=[];for(let f=0;f<a.length;f++){let d=a[f],g=e[e.length-1];ua.test(d)?e.push(d):sa.test(d)||ta.test(d)?(b=!b,e.push(d)):b?e.push(d):""===d||""===g||!g||W.test(g)||W.test(d)||ra.test(d)||oa.test(d)||pa.test(d)||qa.test(d)||va.test(d)||wa.test(d)||!c?e.push(d):e[e.length-1]=g+d}return e.join("\n")}let Qa=[ya,za,Ba,Da],Ra=[Aa],Sa=[Ea,Ha,Ia,Ja,Ka,Ga,Ma,Na,La],Ta=[Oa],Z=[...Qa,...Ra,...Sa,...Ta];
exports.$convertFromMarkdownString=function(a,c=Z,b,e=!1,f=!1){a=e?a:Pa(a,f);return ha(c,e)(a,b)};exports.$convertToMarkdownString=function(a=Z,c,b=!1){return ca(a,b)(c)};exports.BOLD_ITALIC_STAR=Ha;exports.BOLD_ITALIC_UNDERSCORE=Ia;exports.BOLD_STAR=Ja;exports.BOLD_UNDERSCORE=Ka;exports.CHECK_LIST=Ca;exports.CODE=Aa;exports.ELEMENT_TRANSFORMERS=Qa;exports.HEADING=ya;exports.HIGHLIGHT=Ga;exports.INLINE_CODE=Ea;exports.ITALIC_STAR=Ma;exports.ITALIC_UNDERSCORE=Na;exports.LINK=Oa;
exports.MULTILINE_ELEMENT_TRANSFORMERS=Ra;exports.ORDERED_LIST=Da;exports.QUOTE=za;exports.STRIKETHROUGH=La;exports.TEXT_FORMAT_TRANSFORMERS=Sa;exports.TEXT_MATCH_TRANSFORMERS=Ta;exports.TRANSFORMERS=Z;exports.UNORDERED_LIST=Ba;
exports.registerMarkdownShortcuts=function(a,c=Z){let b=J(c),e=I(b.textFormat,({tag:d})=>d[d.length-1]),f=I(b.textMatch,({trigger:d})=>d);for(let d of c)if(c=d.type,"element"===c||"text-match"===c||"multiline-element"===c){c=d.dependencies;for(let g of c)a.hasNode(g)||la(173,g.getType())}return a.registerUpdateListener(({tags:d,dirtyLeaves:g,editorState:n,prevEditorState:h})=>{if(!d.has("collaboration")&&!d.has("historic")&&!a.isComposing()){var r=n.read(p.$getSelection);d=h.read(p.$getSelection);
if(p.$isRangeSelection(d)&&p.$isRangeSelection(r)&&r.isCollapsed()&&!r.is(d)){h=r.anchor.key;var x=r.anchor.offset,w=n._nodeMap.get(h);!p.$isTextNode(w)||!g.has(h)||1!==x&&x>d.anchor.offset+1||a.update(()=>{if(!w.hasFormat("code")){var q=w.getParent();if(null!==q&&!F.$isCodeNode(q)){var l=r.anchor.offset;b:{var m=b.element;var k=q.getParent();if(p.$isRootOrShadowRoot(k)&&q.getFirstChild()===w&&(k=w.getTextContent()," "===k[l-1]))for(let {regExp:B,replace:y}of m)if((m=k.match(B))&&m[0].length===(m[0].endsWith(" ")?
l:l-1)){var t=w.getNextSiblings();let [A,H]=w.splitText(l);A.remove();t=H?[H,...t]:t;if(!1!==y(q,t,m,!1)){k=!0;break b}}k=!1}if(!k){b:{m=b.multilineElement;k=q.getParent();if(p.$isRootOrShadowRoot(k)&&q.getFirstChild()===w&&(k=w.getTextContent()," "===k[l-1]))for(let {regExpStart:B,replace:y,regExpEnd:A}of m)if(!(A&&!("optional"in A)||A&&"optional"in A&&!A.optional)&&(m=k.match(B))&&m[0].length===(m[0].endsWith(" ")?l:l-1)){t=w.getNextSiblings();let [H,Fa]=w.splitText(l);H.remove();t=Fa?[Fa,...t]:
t;if(!1!==y(q,t,m,null,null,!1)){q=!0;break b}}q=!1}if(!q){b:{k=w.getTextContent();q=f[k[l-1]];if(null!=q){l<k.length&&(k=k.slice(0,l));for(u of q)if(u.replace&&u.regExp&&(q=k.match(u.regExp),null!==q)){k=q.index||0;m=k+q[0].length;var v=void 0;0===k?[v]=w.splitText(m):[,v]=w.splitText(k,m);v.selectNext(0,0);u.replace(v,q);var u=!0;break b}}u=!1}if(!u)b:if(m=w.getTextContent(),--l,t=m[l],u=e[t])for(let B of u){var {tag:D}=B;u=D.length;let y=l-u+1;if(!(1<u&&!na(m,y,D,0,u)||" "===m[y-1])&&(v=m[l+1],
!1!==B.intraword||!v||K.test(v))){q=v=w;k=ma(m,y,D);for(var C=q;0>k&&(C=C.getPreviousSibling())&&!p.$isLineBreakNode(C);)p.$isTextNode(C)&&(k=C.getTextContent(),q=C,k=ma(k,k.length,D));if(!(0>k||q===v&&k+u===y||(D=q.getTextContent(),0<k&&D[k-1]===t||(C=D[k-1],!1===B.intraword&&C&&!K.test(C))))){m=v.getTextContent();m=m.slice(0,y)+m.slice(l+1);v.setTextContent(m);m=q===v?m:D;q.setTextContent(m.slice(0,k)+m.slice(k+u));m=p.$getSelection();t=p.$createRangeSelection();p.$setSelection(t);l=l-u*(q===v?
2:1)+1;t.anchor.set(q.__key,k,"text");t.focus.set(v.__key,l,"text");for(let A of B.format)t.hasFormat(A)||t.formatText(A);t.anchor.set(t.focus.key,t.focus.offset,t.focus.type);for(let A of B.format)t.hasFormat(A)&&t.toggleFormat(A);p.$isRangeSelection(m)&&(t.format=m.format);break b}}}}}}}})}}})}
