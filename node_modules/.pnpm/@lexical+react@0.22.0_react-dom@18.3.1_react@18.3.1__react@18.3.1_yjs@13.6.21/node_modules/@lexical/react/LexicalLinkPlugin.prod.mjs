/**
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 */

import{LinkNode as t,TOGGLE_LINK_COMMAND as r,$toggleLink as e}from"@lexical/link";import{useLexicalComposerContext as o}from"@lexical/react/LexicalComposerContext";import{mergeRegister as i,objectKlassEquals as l}from"@lexical/utils";import{COMMAND_PRIORITY_LOW as n,PASTE_COMMAND as a,$getSelection as s,$isRangeSelection as m,$isElementNode as u}from"lexical";import{useEffect as c}from"react";function d({validateUrl:d,attributes:p}){const[f]=o();return c((()=>{if(!f.hasNodes([t]))throw new Error("LinkPlugin: LinkNode not registered on editor");return i(f.registerCommand(r,(t=>{if(null===t)return e(t),!0;if("string"==typeof t)return!(void 0!==d&&!d(t))&&(e(t,p),!0);{const{url:r,target:o,rel:i,title:l}=t;return e(r,{...p,rel:i,target:o,title:l}),!0}}),n),void 0!==d?f.registerCommand(a,(t=>{const e=s();if(!m(e)||e.isCollapsed()||!l(t,ClipboardEvent))return!1;const o=t;if(null===o.clipboardData)return!1;const i=o.clipboardData.getData("text");return!!d(i)&&(!e.getNodes().some((t=>u(t)))&&(f.dispatchCommand(r,{...p,url:i}),t.preventDefault(),!0))}),n):()=>{})}),[f,d,p]),null}export{d as LinkPlugin};
