/**
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 */

'use strict';var h=require("@lexical/utils"),v=require("lexical"),aa=require("@lexical/clipboard");let ba=/^(\d+(?:\.\d+)?)px$/,x={BOTH:3,COLUMN:2,NO_STATUS:0,ROW:1};
class y extends v.ElementNode{static getType(){return"tablecell"}static clone(a){return new y(a.__headerState,a.__colSpan,a.__width,a.__key)}afterCloneFrom(a){super.afterCloneFrom(a);this.__rowSpan=a.__rowSpan;this.__backgroundColor=a.__backgroundColor}static importDOM(){return{td:()=>({conversion:da,priority:0}),th:()=>({conversion:da,priority:0})}}static importJSON(a){let b=a.rowSpan||1;return B(a.headerState,a.colSpan||1,a.width||void 0).setRowSpan(b).setBackgroundColor(a.backgroundColor||null)}constructor(a=
x.NO_STATUS,b=1,c,d){super(d);this.__colSpan=b;this.__rowSpan=1;this.__headerState=a;this.__width=c;this.__backgroundColor=null}createDOM(a){let b=document.createElement(this.getTag());this.__width&&(b.style.width=`${this.__width}px`);1<this.__colSpan&&(b.colSpan=this.__colSpan);1<this.__rowSpan&&(b.rowSpan=this.__rowSpan);null!==this.__backgroundColor&&(b.style.backgroundColor=this.__backgroundColor);h.addClassNamesToElement(b,a.theme.tableCell,this.hasHeader()&&a.theme.tableCellHeader);return b}exportDOM(a){a=
super.exportDOM(a);if(v.isHTMLElement(a.element)){let b=a.element;b.setAttribute("data-temporary-table-cell-lexical-key",this.getKey());b.style.border="1px solid black";1<this.__colSpan&&(b.colSpan=this.__colSpan);1<this.__rowSpan&&(b.rowSpan=this.__rowSpan);b.style.width=`${this.getWidth()||75}px`;b.style.verticalAlign="top";b.style.textAlign="start";null===this.__backgroundColor&&this.hasHeader()&&(b.style.backgroundColor="#f2f3f5")}return a}exportJSON(){return{...super.exportJSON(),backgroundColor:this.getBackgroundColor(),
colSpan:this.__colSpan,headerState:this.__headerState,rowSpan:this.__rowSpan,width:this.getWidth()}}getColSpan(){return this.getLatest().__colSpan}setColSpan(a){let b=this.getWritable();b.__colSpan=a;return b}getRowSpan(){return this.getLatest().__rowSpan}setRowSpan(a){let b=this.getWritable();b.__rowSpan=a;return b}getTag(){return this.hasHeader()?"th":"td"}setHeaderStyles(a,b=x.BOTH){let c=this.getWritable();c.__headerState=a&b|c.__headerState&~b;return c}getHeaderStyles(){return this.getLatest().__headerState}setWidth(a){let b=
this.getWritable();b.__width=a;return b}getWidth(){return this.getLatest().__width}getBackgroundColor(){return this.getLatest().__backgroundColor}setBackgroundColor(a){let b=this.getWritable();b.__backgroundColor=a;return b}toggleHeaderStyle(a){let b=this.getWritable();b.__headerState=(b.__headerState&a)===a?b.__headerState-a:b.__headerState+a;return b}hasHeaderState(a){return(this.getHeaderStyles()&a)===a}hasHeader(){return this.getLatest().__headerState!==x.NO_STATUS}updateDOM(a){return a.__headerState!==
this.__headerState||a.__width!==this.__width||a.__colSpan!==this.__colSpan||a.__rowSpan!==this.__rowSpan||a.__backgroundColor!==this.__backgroundColor}isShadowRoot(){return!0}collapseAtStart(){return!0}canBeEmpty(){return!1}canIndent(){return!1}}
function da(a){var b=a.nodeName.toLowerCase(),c=void 0;ba.test(a.style.width)&&(c=parseFloat(a.style.width));b=B("th"===b?x.ROW:x.NO_STATUS,a.colSpan,c);b.__rowSpan=a.rowSpan;c=a.style.backgroundColor;""!==c&&(b.__backgroundColor=c);a=a.style;c=(a&&a.textDecoration||"").split(" ");let d="700"===a.fontWeight||"bold"===a.fontWeight,f=c.includes("line-through"),e="italic"===a.fontStyle,g=c.includes("underline");return{after:n=>{0===n.length&&n.push(v.$createParagraphNode());return n},forChild:(n,r)=>
{if(C(r)&&!v.$isElementNode(n)){r=v.$createParagraphNode();if(v.$isLineBreakNode(n)&&"\n"===n.getTextContent())return null;v.$isTextNode(n)&&(d&&n.toggleFormat("bold"),f&&n.toggleFormat("strikethrough"),e&&n.toggleFormat("italic"),g&&n.toggleFormat("underline"));r.append(n);return r}return n},node:b}}function B(a=x.NO_STATUS,b=1,c){return v.$applyNodeReplacement(new y(a,b,c))}function C(a){return a instanceof y}let ea=v.createCommand("INSERT_TABLE_COMMAND");var E;
function F(a){let b=new URLSearchParams;b.append("code",a);for(let c=1;c<arguments.length;c++)b.append("v",arguments[c]);throw Error(`Minified Lexical error #${a}; visit https://lexical.dev/docs/error?${b} for the full message or `+"use the non-minified dev environment for full errors and additional helpful warnings.");}E=F&&F.__esModule&&Object.prototype.hasOwnProperty.call(F,"default")?F["default"]:F;
class I extends v.ElementNode{static getType(){return"tablerow"}static clone(a){return new I(a.__height,a.__key)}static importDOM(){return{tr:()=>({conversion:fa,priority:0})}}static importJSON(a){return J(a.height)}constructor(a,b){super(b);this.__height=a}exportJSON(){return{...super.exportJSON(),...(this.getHeight()&&{height:this.getHeight()})}}createDOM(a){let b=document.createElement("tr");this.__height&&(b.style.height=`${this.__height}px`);h.addClassNamesToElement(b,a.theme.tableRow);return b}extractWithChild(a,
b,c){return"html"===c}isShadowRoot(){return!0}setHeight(a){this.getWritable().__height=a;return this.__height}getHeight(){return this.getLatest().__height}updateDOM(a){return a.__height!==this.__height}canBeEmpty(){return!1}canIndent(){return!1}}function fa(a){let b=void 0;ba.test(a.style.height)&&(b=parseFloat(a.style.height));return{after:c=>h.$descendantsMatching(c,C),node:J(b)}}function J(a){return v.$applyNodeReplacement(new I(a))}function K(a){return a instanceof I}
let ha="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement,ia=ha&&"documentMode"in document?document.documentMode:null,ja=ha&&/^(?!.*Seamonkey)(?=.*Firefox).*/i.test(navigator.userAgent);ha&&"InputEvent"in window&&!ia?"getTargetRanges"in new window.InputEvent("input"):!1;
function ka(a,b,c=!0){let d=la();for(let e=0;e<a;e++){let g=J();for(let n=0;n<b;n++){var f=x.NO_STATUS;"object"===typeof c?(0===e&&c.rows&&(f|=x.ROW),0===n&&c.columns&&(f|=x.COLUMN)):c&&(0===e&&(f|=x.ROW),0===n&&(f|=x.COLUMN));f=B(f);let r=v.$createParagraphNode();r.append(v.$createTextNode());f.append(r);g.append(f)}d.append(g)}return d}function ma(a){a=h.$findMatchingParent(a,b=>K(b));if(K(a))return a;throw Error("Expected table cell to be inside of table row.");}
function na(a){a=h.$findMatchingParent(a,b=>L(b));if(L(a))return a;throw Error("Expected table cell to be inside of table.");}function oa(a,b){let c=na(a),{x:d,y:f}=c.getCordsFromCellNode(a,b);return{above:c.getCellNodeFromCords(d,f-1,b),below:c.getCellNodeFromCords(d,f+1,b),left:c.getCellNodeFromCords(d-1,f,b),right:c.getCellNodeFromCords(d+1,f,b)}}let pa=(a,b)=>a===x.BOTH||a===b?b:x.NO_STATUS;function M(a){let b=a.getFirstDescendant();null==b?a.selectStart():b.getParentOrThrow().selectStart()}
function qa(a,b){let c=a.getFirstChild();null!==c?c.insertBefore(b):a.append(b)}function O(a,b,c){let [d,f,e]=ra(a,b,c);null===f&&E(207);null===e&&E(208);return[d,f,e]}
function ra(a,b,c){function d(r){let p=f[r];void 0===p&&(f[r]=p=[]);return p}let f=[],e=null,g=null;a=a.getChildren();for(let r=0;r<a.length;r++){var n=a[r];K(n)||E(209);for(let p=n.getFirstChild(),l=0;null!=p;p=p.getNextSibling()){C(p)||E(147);for(n=d(r);void 0!==n[l];)l++;n={cell:p,startColumn:l,startRow:r};let {__rowSpan:k,__colSpan:m}=p;for(let q=0;q<k&&!(r+q>=a.length);q++){let u=d(r+q);for(let t=0;t<m;t++)u[l+t]=n}null!==b&&null===e&&b.is(p)&&(e=n);null!==c&&null===g&&c.is(p)&&(g=n)}}return[f,
e,g]}function Q(a){a instanceof y||("__type"in a?(a=h.$findMatchingParent(a,C),C(a)||E(148)):(a=h.$findMatchingParent(a.getNode(),C),C(a)||E(148)));let b=a.getParent();K(b)||E(149);let c=b.getParent();L(c)||E(210);return[a,b,c]}
function sa(a,b,c){function d(m){let {cell:q,startColumn:u,startRow:t}=m;f=Math.min(f,u);e=Math.min(e,t);g=Math.max(g,u+q.__colSpan-1);n=Math.max(n,t+q.__rowSpan-1)}let f=Math.min(b.startColumn,c.startColumn),e=Math.min(b.startRow,c.startRow),g=Math.max(b.startColumn+b.cell.__colSpan-1,c.startColumn+c.cell.__colSpan-1),n=Math.max(b.startRow+b.cell.__rowSpan-1,c.startRow+c.cell.__rowSpan-1);b=f;c=e;for(var r=f,p=e;f<b||e<c||g>r||n>p;){if(f<b){var l=p-c;--b;for(var k=0;k<=l;k++)d(a[c+k][b])}if(e<c)for(l=
r-b,--c,k=0;k<=l;k++)d(a[c][b+k]);if(g>r)for(l=p-c,r+=1,k=0;k<=l;k++)d(a[c+k][r]);if(n>p)for(l=r-b,p+=1,k=0;k<=l;k++)d(a[p][b+k])}return{maxColumn:g,maxRow:n,minColumn:f,minRow:e}}
function ta(a){let [b,,c]=Q(a);a=c.getChildren();let d=a.length;var f=a[0].getChildren().length;let e=Array(d);for(var g=0;g<d;g++)e[g]=Array(f);for(f=0;f<d;f++){g=a[f].getChildren();let n=0;for(let r=0;r<g.length;r++){for(;e[f][n];)n++;let p=g[r],l=p.__rowSpan||1,k=p.__colSpan||1;for(let m=0;m<l;m++)for(let q=0;q<k;q++)e[f+m][n+q]=p;if(b===p)return{colSpan:k,columnIndex:n,rowIndex:f,rowSpan:l};n+=k}}return null}
function ua(a){let [[b,c,d,f],[e,g,n,r]]=["anchor","focus"].map(p=>{const l=a[p].getNode(),k=h.$findMatchingParent(l,C);C(k)||E(238,p,l.getKey(),l.getType());const m=k.getParent();K(m)||E(239,p);const q=m.getParent();L(q)||E(240,p);return[l,k,m,q]});f.is(r)||E(241);return{anchorCell:c,anchorNode:b,anchorRow:d,anchorTable:f,focusCell:g,focusNode:e,focusRow:n,focusTable:r}}
class va{constructor(a,b,c){this.anchor=b;this.focus=c;b._selection=this;c._selection=this;this._cachedNodes=null;this.dirty=!1;this.tableKey=a}getStartEndPoints(){return[this.anchor,this.focus]}isValid(){return"root"!==this.tableKey&&"root"!==this.anchor.key&&"element"===this.anchor.type&&"root"!==this.focus.key&&"element"===this.focus.type}isBackward(){return this.focus.isBefore(this.anchor)}getCachedNodes(){return this._cachedNodes}setCachedNodes(a){this._cachedNodes=a}is(a){return R(a)&&this.tableKey===
a.tableKey&&this.anchor.is(a.anchor)&&this.focus.is(a.focus)}set(a,b,c){this.dirty=this.dirty||a!==this.tableKey||b!==this.anchor.key||c!==this.focus.key;this.tableKey=a;this.anchor.key=b;this.focus.key=c;this._cachedNodes=null}clone(){return new va(this.tableKey,v.$createPoint(this.anchor.key,this.anchor.offset,this.anchor.type),v.$createPoint(this.focus.key,this.focus.offset,this.focus.type))}isCollapsed(){return!1}extract(){return this.getNodes()}insertRawText(){}insertText(){}hasFormat(a){let b=
0;this.getNodes().filter(C).forEach(c=>{c=c.getFirstChild();v.$isParagraphNode(c)&&(b|=c.getTextFormat())});return 0!==(b&v.TEXT_TYPE_TO_FORMAT[a])}insertNodes(a){let b=this.focus.getNode();v.$isElementNode(b)||E(151);v.$normalizeSelection__EXPERIMENTAL(b.select(0,b.getChildrenSize())).insertNodes(a)}getShape(){let {anchorCell:a,focusCell:b}=ua(this);var c=ta(a);null===c&&E(153);let d=ta(b);null===d&&E(155);let f=Math.min(c.columnIndex,d.columnIndex),e=Math.max(c.columnIndex+c.colSpan-1,d.columnIndex+
d.colSpan-1),g=Math.min(c.rowIndex,d.rowIndex);c=Math.max(c.rowIndex+c.rowSpan-1,d.rowIndex+d.rowSpan-1);return{fromX:Math.min(f,e),fromY:Math.min(g,c),toX:Math.max(f,e),toY:Math.max(g,c)}}getNodes(){if(!this.isValid())return[];var a=this._cachedNodes;if(null!==a)return a;let {anchorTable:b,anchorCell:c,focusCell:d}=ua(this);a=d.getParents()[1];if(a!==b)return b.isParentOf(d)?(a=a.getParent(),null==a&&E(159),this.set(this.tableKey,d.getKey(),a.getKey())):(a=b.getParent(),null==a&&E(158),this.set(this.tableKey,
a.getKey(),d.getKey())),this.getNodes();let [f,e,g]=O(b,c,d),{minColumn:n,maxColumn:r,minRow:p,maxRow:l}=sa(f,e,g),k=new Map([[b.getKey(),b]]);a=null;for(let m=p;m<=l;m++)for(let q=n;q<=r;q++){let {cell:u}=f[m][q],t=u.getParent();K(t)||E(160);t!==a&&(k.set(t.getKey(),t),a=t);k.has(u.getKey())||wa(u,w=>{k.set(w.getKey(),w)})}a=Array.from(k.values());v.isCurrentlyReadOnlyMode()||(this._cachedNodes=a);return a}getTextContent(){let a=this.getNodes().filter(c=>C(c)),b="";for(let c=0;c<a.length;c++){let d=
a[c],f=d.__parent,e=(a[c+1]||{}).__parent;b+=d.getTextContent()+(e!==f?"\n":"\t")}return b}}function R(a){return a instanceof va}function xa(){let a=v.$createPoint("root",0,"element"),b=v.$createPoint("root",0,"element");return new va("root",a,b)}function wa(a,b){a=[[a]];for(var c=a.at(-1);void 0!==c&&0<a.length;c=a.at(-1))c=c.pop(),void 0===c?a.pop():!1!==b(c)&&v.$isElementNode(c)&&a.push(c.getChildren())}
function ya(a,b=v.$getEditor()){let c=v.$getNodeByKey(a);L(c)||E(231,a);b=S(c,b.getElementByKey(a));null===b&&E(232,a);return{tableElement:b,tableNode:c}}
class za{constructor(a,b){this.isHighlightingCells=!1;this.focusY=this.focusX=this.anchorY=this.anchorX=-1;this.listenersToRemove=new Set;this.tableNodeKey=b;this.editor=a;this.table={columns:0,domRows:[],rows:0};this.focusCell=this.anchorCell=this.focusCellNodeKey=this.anchorCellNodeKey=this.tableSelection=null;this.shouldCheckSelection=this.isSelecting=this.hasHijackedSelectionStyles=!1;this.abortController=new AbortController;this.listenerOptions={signal:this.abortController.signal};this.nextFocus=
null;this.trackTable()}getTable(){return this.table}removeListeners(){this.abortController.abort("removeListeners");Array.from(this.listenersToRemove).forEach(a=>a());this.listenersToRemove.clear()}$lookup(){return ya(this.tableNodeKey,this.editor)}trackTable(){let a=new MutationObserver(b=>{this.editor.getEditorState().read(()=>{let c=!1;for(let e=0;e<b.length;e++){const g=b[e].target.nodeName;if("TABLE"===g||"TBODY"===g||"THEAD"===g||"TR"===g){c=!0;break}}if(c){var {tableNode:d,tableElement:f}=
this.$lookup();this.table=T(d,f)}},{editor:this.editor})});this.editor.getEditorState().read(()=>{let {tableNode:b,tableElement:c}=this.$lookup();this.table=T(b,c);a.observe(c,{attributes:!0,childList:!0,subtree:!0})},{editor:this.editor})}$clearHighlight(){let a=this.editor;this.isHighlightingCells=!1;this.focusY=this.focusX=this.anchorY=this.anchorX=-1;this.focusCell=this.anchorCell=this.focusCellNodeKey=this.anchorCellNodeKey=this.tableSelection=null;this.hasHijackedSelectionStyles=!1;this.$enableHighlightStyle();
let {tableNode:b,tableElement:c}=this.$lookup(),d=T(b,c);Aa(a,d,null);null!==v.$getSelection()&&(v.$setSelection(null),a.dispatchCommand(v.SELECTION_CHANGE_COMMAND,void 0))}$enableHighlightStyle(){let a=this.editor,{tableElement:b}=this.$lookup();h.removeClassNamesFromElement(b,a._config.theme.tableSelection);b.classList.remove("disable-selection");this.hasHijackedSelectionStyles=!1}$disableHighlightStyle(){let {tableElement:a}=this.$lookup();h.addClassNamesToElement(a,this.editor._config.theme.tableSelection);
this.hasHijackedSelectionStyles=!0}$updateTableTableSelection(a){if(null!==a){a.tableKey!==this.tableNodeKey&&E(233,a.tableKey,this.tableNodeKey);let b=this.editor;this.tableSelection=a;this.isHighlightingCells=!0;this.$disableHighlightStyle();this.updateDOMSelection();Aa(b,this.table,this.tableSelection)}else this.$clearHighlight()}setShouldCheckSelection(){this.shouldCheckSelection=!0}getAndClearShouldCheckSelection(){return this.shouldCheckSelection?(this.shouldCheckSelection=!1,!0):!1}setNextFocus(a){this.nextFocus=
a}getAndClearNextFocus(){let {nextFocus:a}=this;null!==a&&(this.nextFocus=null);return a}updateDOMSelection(){if(null!==this.anchorCell&&null!==this.focusCell){let a=v.getDOMSelection(this.editor._window);a&&0<a.rangeCount&&a.removeAllRanges()}}$setFocusCellForSelection(a,b=!1){let c=this.editor,{tableNode:d}=this.$lookup();var f=a.x;let e=a.y;this.focusCell=a;if(!this.isHighlightingCells&&(this.anchorX!==f||this.anchorY!==e||b))this.isHighlightingCells=!0,this.$disableHighlightStyle();else if(f===
this.focusX&&e===this.focusY)return!1;this.focusX=f;this.focusY=e;return this.isHighlightingCells&&(b=U(d,v.$getNearestNodeFromDOMNode(a.elem,void 0)),null!=this.tableSelection&&null!=this.anchorCellNodeKey&&null!==b)?(this.focusCellNodeKey=b.getKey(),a=this.$getAnchorTableCellOrThrow(),d.getKey(),a.getKey(),b.getKey(),f=v.$getSelection(),f=R(f)?f.clone():xa(),f.set(d.getKey(),a.getKey(),b.getKey()),this.tableSelection=f,v.$setSelection(this.tableSelection),c.dispatchCommand(v.SELECTION_CHANGE_COMMAND,
void 0),Aa(c,this.table,this.tableSelection),!0):!1}$getAnchorTableCell(){return this.anchorCellNodeKey?v.$getNodeByKey(this.anchorCellNodeKey):null}$getAnchorTableCellOrThrow(){let a=this.$getAnchorTableCell();null===a&&E(234);return a}$getFocusTableCell(){return this.focusCellNodeKey?v.$getNodeByKey(this.focusCellNodeKey):null}$getFocusTableCellOrThrow(){let a=this.$getFocusTableCell();null===a&&E(235);return a}$setAnchorCellForSelection(a){this.isHighlightingCells=!1;this.anchorCell=a;this.anchorX=
a.x;this.anchorY=a.y;let {tableNode:b}=this.$lookup();a=U(b,v.$getNearestNodeFromDOMNode(a.elem,void 0));null!==a&&(a=a.getKey(),this.tableSelection=null!=this.tableSelection?this.tableSelection.clone():xa(),this.anchorCellNodeKey=a)}$formatCells(a){let b=v.$getSelection();R(b)||E(236);let c=v.$createRangeSelection(),d=c.anchor,f=c.focus,e=b.getNodes().filter(C);0<e.length||E(237);let g=e[0].getFirstChild(),n=v.$isParagraphNode(g)?g.getFormatFlags(a,null):null;e.forEach(r=>{d.set(r.getKey(),0,"element");
f.set(r.getKey(),r.getChildrenSize(),"element");c.formatText(a,n)});v.$setSelection(b);this.editor.dispatchCommand(v.SELECTION_CHANGE_COMMAND,void 0)}$clearText(){let {editor:a}=this,b=v.$getNodeByKey(this.tableNodeKey);if(!L(b))throw Error("Expected TableNode.");var c=v.$getSelection();R(c)||E(253);c=c.getNodes().filter(C);c.length===this.table.columns*this.table.rows?(b.selectPrevious(),b.remove()):(c.forEach(d=>{if(v.$isElementNode(d)){let f=v.$createParagraphNode(),e=v.$createTextNode();f.append(e);
d.append(f);d.getChildren().forEach(g=>{g!==f&&g.remove()})}}),Aa(a,this.table,null),v.$setSelection(null),a.dispatchCommand(v.SELECTION_CHANGE_COMMAND,void 0))}}function S(a,b){if(!b)return b;a="TABLE"===b.nodeName?b:a.getDOMSlot(b).element;"TABLE"!==a.nodeName&&E(245,b.nodeName);return a}function U(a,b){for(let c=b,d=null;null!==c;c=c.getParent()){if(a.is(c))return d;C(c)&&(d=c)}return null}
let Ba=[[v.KEY_ARROW_DOWN_COMMAND,"down"],[v.KEY_ARROW_UP_COMMAND,"up"],[v.KEY_ARROW_LEFT_COMMAND,"backward"],[v.KEY_ARROW_RIGHT_COMMAND,"forward"]],Ca=[v.DELETE_WORD_COMMAND,v.DELETE_LINE_COMMAND,v.DELETE_CHARACTER_COMMAND],Da=[v.KEY_BACKSPACE_COMMAND,v.KEY_DELETE_COMMAND];
function Ea(a,b,c,d){let f=c.getRootElement(),e=c._window;null!==f&&null!==e||E(246);let g=new za(c,a.getKey()),n=S(a,b);Fa(n,g);g.listenersToRemove.add(()=>{Ga(n)===g&&delete n.__lexicalTableSelection});let r=()=>{if(!g.isSelecting){var l=()=>{g.isSelecting=!1;e.removeEventListener("mouseup",l);e.removeEventListener("mousemove",k)},k=m=>{if(v.isDOMNode(m.target))if(1!==(m.buttons&1)&&g.isSelecting)g.isSelecting=!1,e.removeEventListener("mouseup",l),e.removeEventListener("mousemove",k);else{var q=
!n.contains(m.target),u=null;if(q)for(const t of document.elementsFromPoint(m.clientX,m.clientY)){if(u=n.contains(t)?Ha(t):null)break}else u=Ha(m.target);!u||null!==g.focusCell&&u.elem===g.focusCell.elem||(g.setNextFocus({focusCell:u,override:q}),c.dispatchCommand(v.SELECTION_CHANGE_COMMAND,void 0))}};g.isSelecting=!0;e.addEventListener("mouseup",l,g.listenerOptions);e.addEventListener("mousemove",k,g.listenerOptions)}};n.addEventListener("mousedown",l=>{if(0===l.button&&v.isDOMNode(l.target)&&e){var k=
Ha(l.target);null!==k&&c.update(()=>{const m=v.$getPreviousSelection();if(ja&&l.shiftKey&&V(m,a)&&(v.$isRangeSelection(m)||R(m))){const q=m.anchor.getNode(),u=U(a,m.anchor.getNode());u?(g.$setAnchorCellForSelection(W(g,u)),g.$setFocusCellForSelection(k),X(l)):(a.isBefore(q)?a.selectStart():a.selectEnd()).anchor.set(m.anchor.key,m.anchor.offset,m.anchor.type)}else g.$setAnchorCellForSelection(k)});r()}},g.listenerOptions);e.addEventListener("mousedown",l=>{const k=l.target;0===l.button&&v.isDOMNode(k)&&
c.update(()=>{const m=v.$getSelection();R(m)&&m.tableKey===g.tableNodeKey&&f.contains(k)&&g.$clearHighlight()})},g.listenerOptions);for(let [l,k]of Ba)g.listenersToRemove.add(c.registerCommand(l,m=>Ia(c,m,k,a,g),v.COMMAND_PRIORITY_HIGH));g.listenersToRemove.add(c.registerCommand(v.KEY_ESCAPE_COMMAND,l=>{var k=v.$getSelection();return R(k)&&(k=U(a,k.focus.getNode()),null!==k)?(X(l),k.selectEnd(),!0):!1},v.COMMAND_PRIORITY_HIGH));b=l=>()=>{var k=v.$getSelection();if(!V(k,a))return!1;if(R(k))return g.$clearText(),
!0;if(v.$isRangeSelection(k)){var m=U(a,k.anchor.getNode());if(!C(m))return!1;var q=k.anchor.getNode();m=k.focus.getNode();q=a.isParentOf(q);m=a.isParentOf(m);if(q&&!m||m&&!q)return g.$clearText(),!0;m=(k=h.$findMatchingParent(k.anchor.getNode(),u=>v.$isElementNode(u)))&&h.$findMatchingParent(k,u=>v.$isElementNode(u)&&C(u.getParent()));if(!v.$isElementNode(m)||!v.$isElementNode(k))return!1;if(l===v.DELETE_LINE_COMMAND&&null===m.getPreviousSibling())return!0}return!1};for(let l of Ca)g.listenersToRemove.add(c.registerCommand(l,
b(l),v.COMMAND_PRIORITY_CRITICAL));let p=l=>{const k=v.$getSelection();if(!R(k)&&!v.$isRangeSelection(k))return!1;const m=a.isParentOf(k.anchor.getNode()),q=a.isParentOf(k.focus.getNode());if(m!==q){l=m?"focus":"anchor";const {key:u,offset:t,type:w}=k[l];a[k[m?"anchor":"focus"].isBefore(k[l])?"selectPrevious":"selectNext"]()[l].set(u,t,w);return!1}return V(k,a)?R(k)?(l&&(l.preventDefault(),l.stopPropagation()),g.$clearText(),!0):!1:!1};for(let l of Da)g.listenersToRemove.add(c.registerCommand(l,p,
v.COMMAND_PRIORITY_CRITICAL));g.listenersToRemove.add(c.registerCommand(v.CUT_COMMAND,l=>{let k=v.$getSelection();if(k){if(!R(k)&&!v.$isRangeSelection(k))return!1;void aa.copyToClipboard(c,h.objectKlassEquals(l,ClipboardEvent)?l:null,aa.$getClipboardDataFromSelection(k));l=p(l);return v.$isRangeSelection(k)?(k.removeText(),!0):l}return!1},v.COMMAND_PRIORITY_CRITICAL));g.listenersToRemove.add(c.registerCommand(v.FORMAT_TEXT_COMMAND,l=>{let k=v.$getSelection();if(!V(k,a))return!1;if(R(k))return g.$formatCells(l),
!0;v.$isRangeSelection(k)&&(l=h.$findMatchingParent(k.anchor.getNode(),m=>C(m)),C(l));return!1},v.COMMAND_PRIORITY_CRITICAL));g.listenersToRemove.add(c.registerCommand(v.FORMAT_ELEMENT_COMMAND,l=>{var k=v.$getSelection();if(!R(k)||!V(k,a))return!1;var m=k.anchor.getNode();k=k.focus.getNode();if(!C(m)||!C(k))return!1;let [q,u,t]=O(a,m,k);m=Math.max(u.startRow+u.cell.__rowSpan-1,t.startRow+t.cell.__rowSpan-1);k=Math.max(u.startColumn+u.cell.__colSpan-1,t.startColumn+t.cell.__colSpan-1);var w=Math.min(u.startRow,
t.startRow);let D=Math.min(u.startColumn,t.startColumn),z=new Set;for(;w<=m;w++)for(let G=D;G<=k;G++){var A=q[w][G].cell;if(!z.has(A)){z.add(A);A.setFormat(l);A=A.getChildren();for(let H=0;H<A.length;H++){let N=A[H];v.$isElementNode(N)&&!N.isInline()&&N.setFormat(l)}}}return!0},v.COMMAND_PRIORITY_CRITICAL));g.listenersToRemove.add(c.registerCommand(v.CONTROLLED_TEXT_INSERTION_COMMAND,l=>{var k=v.$getSelection();if(!V(k,a))return!1;if(R(k))g.$clearHighlight();else if(v.$isRangeSelection(k)){let m=
h.$findMatchingParent(k.anchor.getNode(),q=>C(q));if(!C(m))return!1;if("string"===typeof l&&(k=Ja(c,k,a)))return La(k,a,[v.$createTextNode(l)]),!0}return!1},v.COMMAND_PRIORITY_CRITICAL));d&&g.listenersToRemove.add(c.registerCommand(v.KEY_TAB_COMMAND,l=>{var k=v.$getSelection();if(!v.$isRangeSelection(k)||!k.isCollapsed()||!V(k,a))return!1;var m=Ma(k.anchor.getNode());if(null===m||!a.is(Na(m)))return!1;X(l);a:{l=l.shiftKey?"previous":"next";k="next"===l?"getNextSibling":"getPreviousSibling";let u=
"next"===l?"getFirstChild":"getLastChild";var q=m[k]();if(v.$isElementNode(q))q.selectEnd();else{m=h.$findMatchingParent(m,K);null===m&&E(247);for(q=m[k]();K(q);q=q[k]()){let t=q[u]();if(v.$isElementNode(t)){t.selectEnd();break a}}k=h.$findMatchingParent(m,L);null===k&&E(248);"next"===l?k.selectNext():k.selectPrevious()}}return!0},v.COMMAND_PRIORITY_CRITICAL));g.listenersToRemove.add(c.registerCommand(v.FOCUS_COMMAND,()=>a.isSelected(),v.COMMAND_PRIORITY_HIGH));g.listenersToRemove.add(c.registerCommand(v.SELECTION_INSERT_CLIPBOARD_NODES_COMMAND,
l=>{let {nodes:k,selection:m}=l;l=m.getStartEndPoints();var q=R(m);q=v.$isRangeSelection(m)&&null!==h.$findMatchingParent(m.anchor.getNode(),H=>C(H))&&null!==h.$findMatchingParent(m.focus.getNode(),H=>C(H))||q;if(1!==k.length||!L(k[0])||!q||null===l)return!1;var [u]=l,t=k[0];l=t.getChildren();q=t.getFirstChildOrThrow().getChildrenSize();t=t.getChildrenSize();var w=h.$findMatchingParent(u.getNode(),H=>C(H)),D=w&&h.$findMatchingParent(w,H=>K(H)),z=D&&h.$findMatchingParent(D,H=>L(H));if(!C(w)||!K(D)||
!L(z))return!1;u=D.getIndexWithinParent();var A=Math.min(z.getChildrenSize()-1,u+t-1);t=w.getIndexWithinParent();w=Math.min(D.getChildrenSize()-1,t+q-1);q=Math.min(t,w);D=Math.min(u,A);t=Math.max(t,w);u=Math.max(u,A);z=z.getChildren();for(A=0;D<=u;D++){w=z[D];if(!K(w))return!1;var G=l[A];if(!K(G))return!1;w=w.getChildren();G=G.getChildren();let H=0;for(let N=q;N<=t;N++){let P=w[N];if(!C(P))return!1;let Ka=G[H];if(!C(Ka))return!1;let Ya=P.getChildren();Ka.getChildren().forEach(ca=>{v.$isTextNode(ca)&&
v.$createParagraphNode().append(ca);P.append(ca)});Ya.forEach(ca=>ca.remove());H++}A++}return!0},v.COMMAND_PRIORITY_CRITICAL));g.listenersToRemove.add(c.registerCommand(v.SELECTION_CHANGE_COMMAND,()=>{let l=v.$getSelection(),k=v.$getPreviousSelection();var m=g.getAndClearNextFocus();if(null!==m){({focusCell:m}=m);if(R(l)&&l.tableKey===g.tableNodeKey){if(m.x===g.focusX&&m.y===g.focusY)return!1;g.$setFocusCellForSelection(m);return!0}if(m!==g.anchorCell&&V(l,a))return g.$setFocusCellForSelection(m),
!0}if(g.getAndClearShouldCheckSelection()&&v.$isRangeSelection(k)&&v.$isRangeSelection(l)&&l.isCollapsed()){var q=l.anchor.getNode();m=a.getFirstChild();q=Ma(q);if(null!==q&&K(m)){let w=m.getFirstChild();if(C(w)&&a.is(h.$findMatchingParent(q,D=>D.is(a)||D.is(w))))return w.selectStart(),!0}}if(v.$isRangeSelection(l)){let {anchor:w,focus:D}=l;q=w.getNode();m=D.getNode();var u=Ma(q),t=Ma(m);let z=!(!u||!a.is(Na(u))),A=!(!t||!a.is(Na(t)));q=z!==A;let G=z&&A;m=l.isBackward();q?(q=l.clone(),A?([t]=O(a,
t,t),u=t[0][0].cell,t=t[t.length-1].at(-1).cell,q.focus.set(m?u.getKey():t.getKey(),m?u.getChildrenSize():t.getChildrenSize(),"element")):z&&([t]=O(a,u,u),u=t[0][0].cell,t=t[t.length-1].at(-1).cell,q.anchor.set(m?t.getKey():u.getKey(),m?t.getChildrenSize():0,"element")),v.$setSelection(q),Oa(c,g)):G&&!u.is(t)&&(g.$setAnchorCellForSelection(W(g,u)),g.$setFocusCellForSelection(W(g,t),!0))}else l&&R(l)&&l.is(k)&&l.tableKey===a.getKey()&&(m=v.getDOMSelection(e))&&m.anchorNode&&m.focusNode&&(q=(q=v.$getNearestNodeFromDOMNode(m.focusNode))&&
!a.isParentOf(q),u=(u=v.$getNearestNodeFromDOMNode(m.anchorNode))&&a.isParentOf(u),q&&u&&0<m.rangeCount&&(q=v.$createRangeSelectionFromDom(m,c)))&&(q.anchor.set(a.getKey(),l.isBackward()?a.getChildrenSize():0,"element"),m.removeAllRanges(),v.$setSelection(q));if(l&&!l.is(k)&&(R(l)||R(k))&&g.tableSelection&&!g.tableSelection.is(k))return R(l)&&l.tableKey===g.tableNodeKey?g.$updateTableTableSelection(l):!R(l)&&R(k)&&k.tableKey===g.tableNodeKey&&g.$updateTableTableSelection(null),!1;g.hasHijackedSelectionStyles&&
!a.isSelected()?Pa(c,g):!g.hasHijackedSelectionStyles&&a.isSelected()&&Oa(c,g);return!1},v.COMMAND_PRIORITY_CRITICAL));g.listenersToRemove.add(c.registerCommand(v.INSERT_PARAGRAPH_COMMAND,()=>{var l=v.$getSelection();return v.$isRangeSelection(l)&&l.isCollapsed()&&V(l,a)?(l=Ja(c,l,a))?(La(l,a),!0):!1:!1},v.COMMAND_PRIORITY_CRITICAL));return g}function Fa(a,b){null!==Ga(a)&&E(205);a.__lexicalTableSelection=b}function Ga(a){return a.__lexicalTableSelection||null}
function Ha(a){for(;null!=a;){let b=a.nodeName;if("TD"===b||"TH"===b){a=a._cell;if(void 0===a)break;return a}a=a.parentNode}return null}
function T(a,b){var c=S(a,b);a=[];b={columns:0,domRows:a,rows:0};var d=c.querySelector("tr");let f=c=0;for(a.length=0;null!=d;){var e=d.nodeName;if("TD"===e||"TH"===e){e=d;e={elem:e,hasBackgroundColor:""!==e.style.backgroundColor,highlighted:!1,x:c,y:f};d._cell=e;let g=a[f];void 0===g&&(g=a[f]=[]);g[c]=e}else if(e=d.firstChild,null!=e){d=e;continue}e=d.nextSibling;if(null!=e)c++,d=e;else if(e=d.parentNode,null!=e){d=e.nextSibling;if(null==d)break;f++;c=0}}b.columns=c+1;b.rows=f+1;return b}
function Aa(a,b,c){let d=new Set(c?c.getNodes():[]);Qa(b,(f,e)=>{let g=f.elem;d.has(e)?(f.highlighted=!0,Ra(a,f)):(f.highlighted=!1,Sa(a,f),g.getAttribute("style")||g.removeAttribute("style"))})}function Qa(a,b){({domRows:a}=a);for(let c=0;c<a.length;c++){let d=a[c];if(d)for(let f=0;f<d.length;f++){let e=d[f];if(!e)continue;let g=v.$getNearestNodeFromDOMNode(e.elem);null!==g&&b(e,g,{x:f,y:c})}}}function Oa(a,b){b.$disableHighlightStyle();Qa(b.table,c=>{c.highlighted=!0;Ra(a,c)})}
function Pa(a,b){b.$enableHighlightStyle();Qa(b.table,c=>{let d=c.elem;c.highlighted=!1;Sa(a,c);d.getAttribute("style")||d.removeAttribute("style")})}
let Ta=(a,b,c,d,f)=>{const e="forward"===f;switch(f){case "backward":case "forward":return c!==(e?a.table.columns-1:0)?(a=b.getCellNodeFromCordsOrThrow(c+(e?1:-1),d,a.table),e?a.selectStart():a.selectEnd()):d!==(e?a.table.rows-1:0)?(a=b.getCellNodeFromCordsOrThrow(e?0:a.table.columns-1,d+(e?1:-1),a.table),e?a.selectStart():a.selectEnd()):e?b.selectNext():b.selectPrevious(),!0;case "up":return 0!==d?b.getCellNodeFromCordsOrThrow(c,d-1,a.table).selectEnd():b.selectPrevious(),!0;case "down":return d!==
a.table.rows-1?b.getCellNodeFromCordsOrThrow(c,d+1,a.table).selectStart():b.selectNext(),!0;default:return!1}};function Ua(a,b){let c;if(b.startColumn===a.minColumn)c="minColumn";else if(b.startColumn+b.cell.__colSpan-1===a.maxColumn)c="maxColumn";else return null;if(b.startRow===a.minRow)a="minRow";else if(b.startRow+b.cell.__rowSpan-1===a.maxRow)a="maxRow";else return null;return[c,a]}function Va([a,b]){return["minColumn"===a?"maxColumn":"minColumn","minRow"===b?"maxRow":"minRow"]}
function Y(a,b,[c,d]){let f=b[d];a=a[f];void 0===a&&E(250,d,String(f));b=b[c];d=a[b];void 0===d&&E(250,c,String(b));return d}
function Wa(a,b,c,d,f){d=sa(b,c,d);let {minColumn:e,maxColumn:g,minRow:n,maxRow:r}=d;var p=1;let l=1,k=1,m=1;var q=b[n];let u=b[r];for(let P=e;P<=g;P++)p=Math.max(p,q[P].cell.__rowSpan),m=Math.max(m,u[P].cell.__rowSpan);for(q=n;q<=r;q++)l=Math.max(l,b[q][e].cell.__colSpan),k=Math.max(k,b[q][g].cell.__colSpan);let {topSpan:t,leftSpan:w,bottomSpan:D,rightSpan:z}={bottomSpan:m,leftSpan:l,rightSpan:k,topSpan:p};p=Ua(d,c);null===p&&E(249,c.cell.getKey());let [A,G]=Va(p);p=d[A];d=d[G];"forward"===f?p+=
"maxColumn"===A?1:w:"backward"===f?p-="minColumn"===A?1:z:"down"===f?d+="maxRow"===G?1:t:"up"===f&&(d-="minRow"===G?1:D);f=b[d];if(void 0===f)return!1;d=f[p];if(void 0===d)return!1;f=sa(b,c,d);(c=Ua(f,c))?b=[Y(b,f,c),Y(b,f,Va(c))]:(c=Ua(f,d))?b=[Y(b,f,Va(c)),Y(b,f,c)]:(c=["minColumn","minRow"],b=[Y(b,f,c),Y(b,f,Va(c))]);let [H,N]=b;b=W(a,H.cell);c=W(a,N.cell);a.$setAnchorCellForSelection(b);a.$setFocusCellForSelection(c,!0);return!0}
function V(a,b){if(v.$isRangeSelection(a)||R(a)){let c=b.isParentOf(a.anchor.getNode());a=b.isParentOf(a.focus.getNode());return c&&a}return!1}function Ra(a,b){b=b.elem;a=a._config.theme;let c=v.$getNearestNodeFromDOMNode(b);C(c)||E(131);h.addClassNamesToElement(b,a.tableCellSelected)}function Sa(a,b){b=b.elem;let c=v.$getNearestNodeFromDOMNode(b);C(c)||E(131);h.removeClassNamesFromElement(b,a._config.theme.tableCellSelected)}function Ma(a){a=h.$findMatchingParent(a,C);return C(a)?a:null}
function Na(a){a=h.$findMatchingParent(a,L);return L(a)?a:null}function Xa(a){for(let b=a,c=a;null!==c;b=c,c=c.getParent())if(v.$isElementNode(c))if(c!==b&&c.getFirstChild()!==b)break;else if(!c.isInline())return c;return null}
function Ia(a,b,c,d,f){if(("up"===c||"down"===c)&&Za(a))return!1;var e=v.$getSelection();if(!V(e,d)){if(v.$isRangeSelection(e)){if("backward"===c){if(0<e.focus.offset)return!1;c=Xa(e.focus.getNode());if(!c)return!1;c=c.getPreviousSibling();if(!L(c))return!1;X(b);b.shiftKey?e.focus.set(c.getParentOrThrow().getKey(),c.getIndexWithinParent(),"element"):c.selectEnd();return!0}if(b.shiftKey&&("up"===c||"down"===c)){var g=e.focus.getNode();if(!e.isCollapsed()&&("up"===c&&!e.isBackward()||"down"===c&&e.isBackward())){f=
h.$findMatchingParent(g,p=>L(p));C(f)&&(f=h.$findMatchingParent(f,L));if(f!==d||!f)return!1;d="down"===c?f.getNextSibling():f.getPreviousSibling();if(!d)return!1;f=0;"up"===c&&v.$isElementNode(d)&&(f=d.getChildrenSize());a=d;"up"===c&&v.$isElementNode(d)&&(a=(c=d.getLastChild())?c:d,f=v.$isTextNode(a)?a.getTextContentSize():0);c=e.clone();c.focus.set(a.getKey(),f,v.$isTextNode(a)?"text":"element");v.$setSelection(c);X(b);return!0}if(v.$isRootOrShadowRoot(g)){if((b="up"===c?e.getNodes()[e.getNodes().length-
1]:e.getNodes()[0])&&null!==U(d,b)){c=d.getFirstDescendant();b=d.getLastDescendant();if(!c||!b)return!1;[c]=Q(c);[b]=Q(b);c=d.getCordsFromCellNode(c,f.table);b=d.getCordsFromCellNode(b,f.table);c=d.getDOMCellFromCordsOrThrow(c.x,c.y,f.table);b=d.getDOMCellFromCordsOrThrow(b.x,b.y,f.table);f.$setAnchorCellForSelection(c);f.$setFocusCellForSelection(b,!0);return!0}return!1}d=h.$findMatchingParent(g,p=>v.$isElementNode(p)&&!p.isInline());C(d)&&(d=h.$findMatchingParent(d,L));if(!d)return!1;d="down"===
c?d.getNextSibling():d.getPreviousSibling();if(L(d)&&f.tableNodeKey===d.getKey()){f=d.getFirstDescendant();a=d.getLastDescendant();if(!f||!a)return!1;[d]=Q(f);[f]=Q(a);e=e.clone();e.focus.set(("up"===c?d:f).getKey(),"up"===c?0:f.getChildrenSize(),"element");X(b);v.$setSelection(e);return!0}}}"down"===c&&$a(a)&&f.setShouldCheckSelection();return!1}if(v.$isRangeSelection(e)&&e.isCollapsed()){let {anchor:p,focus:l}=e;g=h.$findMatchingParent(p.getNode(),C);var n=h.$findMatchingParent(l.getNode(),C);if(!C(g)||
!g.is(n))return!1;n=Na(g);if(n!==d&&null!=n){var r=S(n,a.getElementByKey(n.getKey()));if(null!=r)return f.table=T(n,r),Ia(a,b,c,n,f)}if("backward"===c||"forward"===c){f=p.type;a=p.offset;n=p.getNode();if(!n)return!1;e=e.getNodes();return 1===e.length&&v.$isDecoratorNode(e[0])?!1:ab(f,a,n,c)?bb(b,n,g,d,c):!1}e=a.getElementByKey(g.__key);n=a.getElementByKey(p.key);if(null==n||null==e)return!1;if("element"===p.type)e=n.getBoundingClientRect();else{e=v.getDOMSelection(a._window);if(null===e||0===e.rangeCount)return!1;
e=e.getRangeAt(0).getBoundingClientRect()}n="up"===c?g.getFirstChild():g.getLastChild();if(null==n)return!1;a=a.getElementByKey(n.__key);if(null==a)return!1;a=a.getBoundingClientRect();if("up"===c?a.top>e.top-e.height:e.bottom+e.height>a.bottom){X(b);e=d.getCordsFromCellNode(g,f.table);if(b.shiftKey)b=d.getDOMCellFromCordsOrThrow(e.x,e.y,f.table),f.$setAnchorCellForSelection(b),f.$setFocusCellForSelection(b,!0);else return Ta(f,d,e.x,e.y,c);return!0}}else if(R(e)){let {anchor:p,focus:l}=e;g=h.$findMatchingParent(p.getNode(),
C);n=h.$findMatchingParent(l.getNode(),C);[r]=e.getNodes();L(r)||E(251);a=S(r,a.getElementByKey(r.getKey()));if(!C(g)||!C(n)||!L(r)||null==a)return!1;f.$updateTableTableSelection(e);e=T(r,a);a=d.getCordsFromCellNode(g,e);e=d.getDOMCellFromCordsOrThrow(a.x,a.y,e);f.$setAnchorCellForSelection(e);X(b);if(b.shiftKey){let [k,m,q]=O(d,g,n);return Wa(f,k,m,q,c)}n.selectEnd();return!0}return!1}function X(a){a.preventDefault();a.stopImmediatePropagation();a.stopPropagation()}
function Za(a){return(a=a.getRootElement())?a.hasAttribute("aria-controls")&&"typeahead-menu"===a.getAttribute("aria-controls"):!1}function ab(a,b,c,d){return"element"===a&&("backward"===d?null===c.getPreviousSibling():null===c.getNextSibling())||cb(a,b,c,d)}
function cb(a,b,c,d){let f=h.$findMatchingParent(c,e=>v.$isElementNode(e)&&!e.isInline());if(!f)return!1;b="backward"===d?0===b:b===c.getTextContentSize();return"text"===a&&b&&("backward"===d?null===f.getPreviousSibling():null===f.getNextSibling())}
function bb(a,b,c,d,f){let [e,g]=O(d,c,c);c=e[0][0];let n=e[e.length-1][e[0].length-1],{startColumn:r,startRow:p}=g;if("backward"===f?r!==c.startColumn||p!==c.startRow:r!==n.startColumn||p!==n.startRow)return!1;b=db(b,f,d);if(!b||L(b))return!1;X(a);"backward"===f?b.selectEnd():b.selectStart();return!0}
function db(a,b,c){if(a=h.$findMatchingParent(a,d=>v.$isElementNode(d)&&!d.isInline()))return(a="backward"===b?a.getPreviousSibling():a.getNextSibling())&&L(a)?a:"backward"===b?c.getPreviousSibling():c.getNextSibling()}function La(a,b,c){let d=v.$createParagraphNode();"first"===a?b.insertBefore(d):b.insertAfter(d);d.append(...(c||[]));d.selectEnd()}
function Ja(a,b,c){var d=c.getParent();if(d){var f=v.getDOMSelection(a._window);if(f&&(f=f.anchorNode,d=a.getElementByKey(d.getKey()),a=S(c,a.getElementByKey(c.getKey())),f&&d&&a&&d.contains(f)&&!a.contains(f)&&(b=h.$findMatchingParent(b.anchor.getNode(),p=>C(p))))&&(a=h.$findMatchingParent(b,p=>L(p)),L(a)&&a.is(c))){var [e,g]=O(c,b,b);c=e[0][0];b=e[e.length-1][e[0].length-1];var {startRow:n,startColumn:r}=g;if(n===c.startRow&&r===c.startColumn)return"first";if(n===b.startRow&&r===b.startColumn)return"last"}}}
function W(a,b){let {tableNode:c}=a.$lookup();b=c.getCordsFromCellNode(b,a.table);return c.getDOMCellFromCordsOrThrow(b.x,b.y,a.table)}function eb(a,b,c,d){if(a=a.querySelector("colgroup")){b=[];for(let f=0;f<c;f++){let e=document.createElement("col"),g=d&&d[f];g&&(e.style.width=`${g}px`);b.push(e)}a.replaceChildren(...b)}}
function fb(a,b,c){c?(h.addClassNamesToElement(a,b.theme.tableRowStriping),a.setAttribute("data-lexical-row-striping","true")):(h.removeClassNamesFromElement(a,b.theme.tableRowStriping),a.removeAttribute("data-lexical-row-striping"))}let gb=new WeakSet;function $a(a=v.$getEditor()){return gb.has(a)}
class Z extends v.ElementNode{static getType(){return"table"}getColWidths(){return this.getLatest().__colWidths}setColWidths(a){let b=this.getWritable();b.__colWidths=a;return b}static clone(a){return new Z(a.__key)}afterCloneFrom(a){super.afterCloneFrom(a);this.__colWidths=a.__colWidths;this.__rowStriping=a.__rowStriping}static importDOM(){return{table:()=>({conversion:hb,priority:1})}}static importJSON(a){let b=la();b.__rowStriping=a.rowStriping||!1;b.__colWidths=a.colWidths;return b}constructor(a){super(a);
this.__rowStriping=!1}exportJSON(){return{...super.exportJSON(),colWidths:this.getColWidths(),rowStriping:this.__rowStriping?this.__rowStriping:void 0}}extractWithChild(a,b,c){return"html"===c}getDOMSlot(a){a="TABLE"!==a.nodeName&&a.querySelector("table")||a;"TABLE"!==a.nodeName&&E(229);return super.getDOMSlot(a).withAfter(a.querySelector("colgroup"))}createDOM(a,b){let c=document.createElement("table"),d=document.createElement("colgroup");c.appendChild(d);eb(c,a,this.getColumnCount(),this.getColWidths());
v.setDOMUnmanaged(d);h.addClassNamesToElement(c,a.theme.table);this.__rowStriping&&fb(c,a,!0);return $a(b)?(b=document.createElement("div"),(a=a.theme.tableScrollableWrapper)?h.addClassNamesToElement(b,a):b.style.cssText="overflow-x: auto;",b.appendChild(c),b):c}updateDOM(a,b,c){a.__rowStriping!==this.__rowStriping&&fb(b,c,this.__rowStriping);eb(b,c,this.getColumnCount(),this.getColWidths());return!1}exportDOM(a){let b=super.exportDOM(a);({element:a}=b);return{after:c=>{b.after&&(c=b.after(c));h.isHTMLElement(c)&&
"TABLE"!==c.nodeName&&(c=c.querySelector("table"));if(!h.isHTMLElement(c))return null;var [d]=ra(this,null,null),f=new Map;for(var e of d)for(var g of e)d=g.cell.getKey(),f.has(d)||f.set(d,{colSpan:g.cell.getColSpan(),startColumn:g.startColumn});let n=new Set;for(var r of c.querySelectorAll(":scope > tr > [data-temporary-table-cell-lexical-key]"))if(g=r.getAttribute("data-temporary-table-cell-lexical-key"))if(e=f.get(g),r.removeAttribute("data-temporary-table-cell-lexical-key"),e)for(f.delete(g),
g=0;g<e.colSpan;g++)n.add(g+e.startColumn);if(f=c.querySelector(":scope > colgroup"))r=Array.from(c.querySelectorAll(":scope > colgroup > col")).filter((p,l)=>n.has(l)),f.replaceChildren(...r);f=c.querySelectorAll(":scope > tr");if(0<f.length){r=document.createElement("tbody");for(let p of f)r.appendChild(p);c.append(r)}return c},element:h.isHTMLElement(a)&&"TABLE"!==a.nodeName?a.querySelector("table"):a}}canBeEmpty(){return!1}isShadowRoot(){return!0}getCordsFromCellNode(a,b){let {rows:c,domRows:d}=
b;for(b=0;b<c;b++){let e=d[b];if(null!=e)for(let g=0;g<e.length;g++){var f=e[g];if(null!=f&&({elem:f}=f,f=U(this,v.$getNearestNodeFromDOMNode(f,void 0)),null!==f&&a.is(f)))return{x:g,y:b}}}throw Error("Cell not found in table.");}getDOMCellFromCords(a,b,c){({domRows:c}=c);b=c[b];if(null==b)return null;a=b[a<b.length?a:b.length-1];return null==a?null:a}getDOMCellFromCordsOrThrow(a,b,c){a=this.getDOMCellFromCords(a,b,c);if(!a)throw Error("Cell not found at cords.");return a}getCellNodeFromCords(a,b,
c){a=this.getDOMCellFromCords(a,b,c);if(null==a)return null;a=v.$getNearestNodeFromDOMNode(a.elem);return C(a)?a:null}getCellNodeFromCordsOrThrow(a,b,c){a=this.getCellNodeFromCords(a,b,c);if(!a)throw Error("Node at cords not TableCellNode.");return a}getRowStriping(){return!!this.getLatest().__rowStriping}setRowStriping(a){this.getWritable().__rowStriping=a}canSelectBefore(){return!0}canIndent(){return!1}getColumnCount(){let a=this.getFirstChild();if(!a)return 0;let b=0;a.getChildren().forEach(c=>
{C(c)&&(b+=c.getColSpan())});return b}}function hb(a){let b=la();a.hasAttribute("data-lexical-row-striping")&&b.setRowStriping(!0);var c=a.querySelector(":scope > colgroup");if(c){a=[];for(let d of c.querySelectorAll(":scope > col")){c=d.style.width||"";if(!ba.test(c)&&(c=d.getAttribute("width")||"",!/^\d+$/.test(c))){a=void 0;break}a.push(parseFloat(c))}a&&b.setColWidths(a)}return{after:d=>h.$descendantsMatching(d,K),node:b}}function la(){return v.$applyNodeReplacement(new Z)}
function L(a){return a instanceof Z}function ib({rows:a,columns:b,includeHeaders:c}){a=ka(Number(a),Number(b),c);h.$insertNodeToNearestRoot(a);a=a.getFirstDescendant();v.$isTextNode(a)&&a.select();return!0}function jb(a){K(a.getParent())?a.isEmpty()&&a.append(v.$createParagraphNode()):a.remove()}function kb(a){L(a.getParent())?h.$unwrapAndFilterDescendants(a,C):a.remove()}
function lb(a){h.$unwrapAndFilterDescendants(a,K);let [b]=ra(a,null,null),c=b.reduce((f,e)=>Math.max(f,e.length),0);a=a.getChildren();for(let f=0;f<b.length;++f){let e=a[f];if(e){K(e)||E(254,e.constructor.name,e.getType());var d=b[f].reduce((g,n)=>n?1+g:g,0);if(d!==c)for(;d<c;++d){let g=B();g.append(v.$createParagraphNode());e.append(g)}}}}exports.$computeTableMap=O;exports.$computeTableMapSkipCellCheck=ra;exports.$createTableCellNode=B;exports.$createTableNode=la;
exports.$createTableNodeWithDimensions=ka;exports.$createTableRowNode=J;exports.$createTableSelection=xa;exports.$deleteTableColumn=function(a,b){let c=a.getChildren();for(let f=0;f<c.length;f++){var d=c[f];if(K(d)){d=d.getChildren();if(b>=d.length||0>b)throw Error("Table column target index out of range");d[b].remove()}}return a};
exports.$deleteTableColumn__EXPERIMENTAL=function(){var a=v.$getSelection();v.$isRangeSelection(a)||R(a)||E(188);var b=a.anchor.getNode();a=a.focus.getNode();let [c,,d]=Q(b);var [f]=Q(a);let [e,g,n]=O(d,c,f);var {startColumn:r}=g;let {startRow:p,startColumn:l}=n;b=Math.min(r,l);var k=Math.max(r+c.__colSpan-1,l+f.__colSpan-1);a=k-b+1;if(e[0].length===k-b+1)d.selectPrevious(),d.remove();else{var m=e.length;for(let q=0;q<m;q++)for(let u=b;u<=k;u++){let {cell:t,startColumn:w}=e[q][u];w<b?u===b&&t.setColSpan(t.__colSpan-
Math.min(a,t.__colSpan-(b-w))):w+t.__colSpan-1>k?u===k&&t.setColSpan(t.__colSpan-(k-w+1)):t.remove()}k=e[p];f=r>l?k[r+c.__colSpan]:k[l+f.__colSpan];void 0!==f?({cell:r}=f,M(r)):({cell:r}=l<r?k[l-1]:k[r-1],M(r));if(r=d.getColWidths())r=[...r],r.splice(b,a),d.setColWidths(r)}};
exports.$deleteTableRow__EXPERIMENTAL=function(){var a=v.$getSelection();v.$isRangeSelection(a)||R(a)||E(188);let [b,c]=a.isBackward()?[a.focus.getNode(),a.anchor.getNode()]:[a.anchor.getNode(),a.focus.getNode()],[d,,f]=Q(b);var [e]=Q(c);let [g,n,r]=O(f,d,e);({startRow:a}=n);var {startRow:p}=r;e=p+e.__rowSpan-1;if(g.length===e-a+1)f.remove();else{p=g[0].length;var l=d.__rowSpan,k=g[e+1],m=f.getChildAtIndex(e+1);for(let u=e;u>=a;u--){for(var q=p-1;0<=q;q--){let {cell:t,startRow:w,startColumn:D}=g[u][q];
if(D===q&&(u===a&&w<a&&t.setRowSpan(t.__rowSpan-Math.min(l,t.__rowSpan-(a-w))),w>=a&&w+t.__rowSpan-1>e)){t.setRowSpan(t.__rowSpan-(e-w+1));null===m&&E(122);let z=null;for(let A=0;A<q;A++){let G=k[A],H=G.cell;G.startRow===u+1&&(z=H);1<H.__colSpan&&(A+=H.__colSpan-1)}null===z?qa(m,t):z.insertAfter(t)}}q=f.getChildAtIndex(u);K(q)||E(206,String(u));q.remove()}void 0!==k?({cell:a}=k[0],M(a)):({cell:a}=g[a-1][0],M(a))}};exports.$findCellNode=Ma;exports.$findTableNode=Na;
exports.$getElementForTableNode=function(a,b){a=a.getElementByKey(b.getKey());null===a&&E(230);return T(b,a)};exports.$getNodeTriplet=Q;exports.$getTableAndElementByKey=ya;exports.$getTableCellNodeFromLexicalNode=function(a){a=h.$findMatchingParent(a,b=>C(b));return C(a)?a:null};exports.$getTableCellNodeRect=ta;exports.$getTableColumnIndexFromTableCellNode=function(a){return ma(a).getChildren().findIndex(b=>b.is(a))};exports.$getTableNodeFromLexicalNodeOrThrow=na;
exports.$getTableRowIndexFromTableCellNode=function(a){let b=ma(a);return na(b).getChildren().findIndex(c=>c.is(b))};exports.$getTableRowNodeFromTableCellNodeOrThrow=ma;
exports.$insertTableColumn=function(a,b,c=!0,d,f){let e=a.getChildren(),g=[];for(let p=0;p<e.length;p++){let l=e[p];if(K(l))for(let k=0;k<d;k++){var n=l.getChildren();if(b>=n.length||0>b)throw Error("Table column target index out of range");n=n[b];C(n)||E(12);let {left:m,right:q}=oa(n,f);var r=x.NO_STATUS;if(m&&m.hasHeaderState(x.ROW)||q&&q.hasHeaderState(x.ROW))r|=x.ROW;r=B(r);r.append(v.$createParagraphNode());g.push({newTableCell:r,targetCell:n})}}g.forEach(({newTableCell:p,targetCell:l})=>{c?
l.insertAfter(p):l.insertBefore(p)});return a};
exports.$insertTableColumn__EXPERIMENTAL=function(a=!0){function b(k=x.NO_STATUS){k=B(k).append(v.$createParagraphNode());null===p&&(p=k);return k}var c=v.$getSelection();v.$isRangeSelection(c)||R(c)||E(188);var d=c.anchor.getNode();c=c.focus.getNode();[d]=Q(d);let [f,,e]=Q(c),[g,n,r]=O(e,f,d);d=g.length;c=a?Math.max(n.startColumn,r.startColumn):Math.min(n.startColumn,r.startColumn);a=a?c+f.__colSpan-1:c-1;c=e.getFirstChild();K(c)||E(120);let p=null;var l=c;a:for(c=0;c<d;c++){0!==c&&(l=l.getNextSibling(),
K(l)||E(121));let k=g[c],m=pa(k[0>a?0:a].cell.__headerState,x.ROW);if(0>a){qa(l,b(m));continue}let {cell:q,startColumn:u,startRow:t}=k[a];if(u+q.__colSpan-1<=a){let w=q,D=t,z=a;for(;D!==c&&1<w.__rowSpan;)if(z-=q.__colSpan,0<=z){let {cell:A,startRow:G}=k[z];w=A;D=G}else{l.append(b(m));continue a}w.insertAfter(b(m))}else q.setColSpan(q.__colSpan+1)}null!==p&&M(p);if(d=e.getColWidths())d=[...d],a=0>a?0:a,d.splice(a,0,d[a]),e.setColWidths(d);return p};
exports.$insertTableRow=function(a,b,c=!0,d,f){var e=a.getChildren();if(b>=e.length||0>b)throw Error("Table row target index out of range");b=e[b];if(K(b))for(e=0;e<d;e++){let n=b.getChildren(),r=n.length,p=J();for(let l=0;l<r;l++){var g=n[l];C(g)||E(12);let {above:k,below:m}=oa(g,f);g=x.NO_STATUS;let q=k&&k.getWidth()||m&&m.getWidth()||void 0;if(k&&k.hasHeaderState(x.COLUMN)||m&&m.hasHeaderState(x.COLUMN))g|=x.COLUMN;g=B(g,1,q);g.append(v.$createParagraphNode());p.append(g)}c?b.insertAfter(p):b.insertBefore(p)}else throw Error("Row before insertion index does not exist.");
return a};
exports.$insertTableRow__EXPERIMENTAL=function(a=!0){var b=v.$getSelection();v.$isRangeSelection(b)||R(b)||E(188);var c=b.anchor.getNode(),d=b.focus.getNode();[b]=Q(c);let [f,,e]=Q(d),[g,n,r]=O(e,f,b);c=g[0].length;({startRow:d}=r);var {startRow:p}=n;if(a){b=Math.max(p+f.__rowSpan,d+b.__rowSpan)-1;d=g[b];a=J();for(p=0;p<c;p++){let {cell:k,startRow:m}=d[p];if(m+k.__rowSpan-1<=b){var l=pa(d[p].cell.__headerState,x.COLUMN);a.append(B(l).append(v.$createParagraphNode()))}else k.setRowSpan(k.__rowSpan+1)}c=
e.getChildAtIndex(b);K(c)||E(256);c.insertAfter(a);c=a}else{b=Math.min(p,d);d=g[b];a=J();for(p=0;p<c;p++){let {cell:k,startRow:m}=d[p];m===b?(l=pa(d[p].cell.__headerState,x.COLUMN),a.append(B(l).append(v.$createParagraphNode()))):k.setRowSpan(k.__rowSpan+1)}c=e.getChildAtIndex(b);K(c)||E(257);c.insertBefore(a);c=a}return c};exports.$isScrollableTablesActive=$a;exports.$isTableCellNode=C;exports.$isTableNode=L;exports.$isTableRowNode=K;exports.$isTableSelection=R;
exports.$removeTableRowAtIndex=function(a,b){let c=a.getChildren();if(b>=c.length||0>b)throw Error("Expected table cell to be inside of table row.");c[b].remove();return a};
exports.$unmergeCell=function(){var a=v.$getSelection();v.$isRangeSelection(a)||R(a)||E(188);a=a.anchor.getNode();let [b,c,d]=Q(a);a=b.__colSpan;let f=b.__rowSpan;if(1!==a||1!==f){var [e,g]=O(d,b,b),{startColumn:n,startRow:r}=g,p=b.__headerState&x.COLUMN,l=Array.from({length:a},(w,D)=>{w=p;for(let z=0;0!==w&&z<e.length;z++)w&=e[z][D+n].cell.__headerState;return w}),k=b.__headerState&x.ROW,m=Array.from({length:f},(w,D)=>{w=k;for(let z=0;0!==w&&z<e[0].length;z++)w&=e[D+r][z].cell.__headerState;return w});
if(1<a){for(var q=1;q<a;q++)b.insertAfter(B(l[q]|m[0]).append(v.$createParagraphNode()));b.setColSpan(1)}if(1<f){let w;for(q=1;q<f;q++){var u=r+q;let D=e[u];w=(w||c).getNextSibling();K(w)||E(125);var t=null;for(let z=0;z<n;z++){let A=D[z],G=A.cell;A.startRow===u&&(t=G);1<G.__colSpan&&(z+=G.__colSpan-1)}if(null===t)for(t=a-1;0<=t;t--)qa(w,B(l[t]|m[q]).append(v.$createParagraphNode()));else for(u=a-1;0<=u;u--)t.insertAfter(B(l[u]|m[q]).append(v.$createParagraphNode()))}b.setRowSpan(1)}}};
exports.INSERT_TABLE_COMMAND=ea;exports.TableCellHeaderStates=x;exports.TableCellNode=y;exports.TableNode=Z;exports.TableObserver=za;exports.TableRowNode=I;exports.applyTableHandlers=Ea;exports.getDOMCellFromTarget=Ha;exports.getTableElement=S;exports.getTableObserverFromTableElement=Ga;
exports.registerTableCellUnmergeTransform=function(a){return a.registerNodeTransform(y,b=>{if(1<b.getColSpan()||1<b.getRowSpan()){var [,,c]=Q(b);[b]=O(c,b,b);let f=b.length,e=b[0].length;c=c.getFirstChild();K(c)||E(175);let g=[];for(let n=0;n<f;n++){0!==n&&(c=c.getNextSibling(),K(c)||E(175));let r=null;for(let p=0;p<e;p++){var d=b[n][p];let l=d.cell;if(d.startRow===n&&d.startColumn===p)r=l,g.push(l);else if(1<l.getColSpan()||1<l.getRowSpan())C(l)||E(176),d=B(l.__headerState),null!==r?r.insertAfter(d):
h.$insertFirst(c,d)}}for(let n of g)n.setColSpan(1),n.setRowSpan(1)}})};exports.registerTablePlugin=function(a){a.hasNodes([Z])||E(255);return h.mergeRegister(a.registerCommand(ea,ib,v.COMMAND_PRIORITY_EDITOR),a.registerNodeTransform(Z,lb),a.registerNodeTransform(I,kb),a.registerNodeTransform(y,jb))};
exports.registerTableSelectionObserver=function(a,b=!0){let c=new Map,d=(e,g,n)=>{n=S(e,n);e=Ea(e,n,a,b);c.set(g,[e,n])},f=a.registerMutationListener(Z,e=>{a.getEditorState().read(()=>{for(const [g,n]of e){const r=c.get(g);if("created"===n||"updated"===n){const {tableNode:p,tableElement:l}=ya(g);void 0===r?d(p,g,l):l!==r[1]&&(r[0].removeListeners(),c.delete(g),d(p,g,l))}else"destroyed"===n&&void 0!==r&&(r[0].removeListeners(),c.delete(g))}},{editor:a})},{skipInitialization:!1});return()=>{f();for(let [,
[e]]of c)e.removeListeners()}};exports.setScrollableTablesActive=function(a,b){b?gb.add(a):gb.delete(a)}
