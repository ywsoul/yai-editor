/**
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 */

'use strict';var g=require("lexical"),u=require("@lexical/selection"),C;function D(a){let b=new URLSearchParams;b.append("code",a);for(let c=1;c<arguments.length;c++)b.append("v",arguments[c]);throw Error(`Minified Lexical error #${a}; visit https://lexical.dev/docs/error?${b} for the full message or `+"use the non-minified dev environment for full errors and additional helpful warnings.");}C=D&&D.__esModule&&Object.prototype.hasOwnProperty.call(D,"default")?D["default"]:D;
let E="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement,F=E&&"documentMode"in document?document.documentMode:null,G=E&&/Mac|iPod|iPhone|iPad/.test(navigator.platform),H=E&&/^(?!.*Seamonkey)(?=.*Firefox).*/i.test(navigator.userAgent),aa=E&&"InputEvent"in window&&!F?"getTargetRanges"in new window.InputEvent("input"):!1,ba=E&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent),ca=E&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,
I=E&&/Android/.test(navigator.userAgent),J=E&&/^(?=.*Chrome).*/i.test(navigator.userAgent),da=E&&I&&J;function K(...a){let b=[];for(let c of a)if(c&&"string"===typeof c)for(let [d]of c.matchAll(/\S+/g))b.push(d);return b}function L(...a){return()=>{for(let b=a.length-1;0<=b;b--)a[b]();a.length=0}}let ea={attributes:!0,characterData:!0,childList:!0,subtree:!0};
function M(a,b,c){function d(){null===h&&C(182);null===l&&C(183);let {left:x,top:z}=l.getBoundingClientRect(),y=u.createRectsFromDOMRange(a,b);p.isConnected||l.insertBefore(p,l.firstChild);let q=!1;for(let A=0;A<y.length;A++){var r=y[A];let v=k[A]||document.createElement("div"),w=v.style;"absolute"!==w.position&&(w.position="absolute",q=!0);var n=`${r.left-x}px`;w.left!==n&&(w.left=n,q=!0);n=`${r.top-z}px`;w.top!==n&&(v.style.top=n,q=!0);n=`${r.width}px`;w.width!==n&&(v.style.width=n,q=!0);r=`${r.height}px`;
w.height!==r&&(v.style.height=r,q=!0);v.parentNode!==p&&(p.append(v),q=!0);k[A]=v}for(;k.length>y.length;)k.pop();q&&c(k)}function e(){h=l=null;null!==m&&m.disconnect();m=null;p.remove();for(let x of k)x.remove();k=[]}function f(){let x=a.getRootElement();if(null===x)return e();let z=x.parentElement;if(!g.isHTMLElement(z))return e();e();h=x;l=z;m=new MutationObserver(y=>{let q=a.getRootElement(),r=q&&q.parentElement;if(q!==h||r!==l)return f();for(let n of y)if(!p.contains(n.target))return d()});m.observe(z,
ea);d()}let h=null,l=null,m=null,k=[],p=document.createElement("div");p.style.position="relative";let B=a.registerRootListener(f);return()=>{B();e()}}function N(a,b,c){return"text"!==a.type&&g.$isElementNode(b)?(b=b.getDOMSlot(c),[b.element,b.getFirstChildOffset()+a.offset]):[g.getDOMTextNode(c)||c,a.offset]}
function fa(a,b,c,d,e,f,h){a=(a._window?a._window.document:document).createRange();f.isBefore(c)?(a.setStart(...N(e,f,h)),a.setEnd(...N(b,c,d))):(a.setStart(...N(b,c,d)),a.setEnd(...N(e,f,h)));return a}
function O(a,b){function c(p){p.read(()=>{var B=g.$getSelection();if(g.$isRangeSelection(B)){var {anchor:x,focus:z}=B;B=x.getNode();var y=B.getKey(),q=x.offset,r=z.getNode(),n=r.getKey(),A=z.offset,v=a.getElementByKey(y),w=a.getElementByKey(n);y=null===d||v!==e||q!==f||y!==d.getKey();n=null===h||w!==l||A!==m||n!==h.getKey();(y||n)&&null!==v&&null!==w&&(n=fa(a,x,B,v,z,r,w),k(),k=M(a,n,t=>{if(void 0===b)for(let ha of t)t=ha.style,"Highlight"!==t.background&&(t.background="Highlight"),"HighlightText"!==
t.color&&(t.color="HighlightText"),"-1.5px"!==t.marginTop&&(t.marginTop="-1.5px"),"4px"!==t.paddingTop&&(t.paddingTop="4px"),"0px"!==t.paddingBottom&&(t.paddingBottom="0px");else b(t)}));d=B;e=v;f=q;h=r;l=w;m=A}else m=h=f=d=null,k(),k=()=>{}})}let d=null,e=null,f=null,h=null,l=null,m=null,k=()=>{};c(a.getEditorState());return L(a.registerUpdateListener(({editorState:p})=>c(p)),()=>{k()})}let ia=E&&/AppleWebKit\/[\d.]+/.test(navigator.userAgent)&&!J;
function P(a,b){for(let c of b)if(a.type.startsWith(c))return!0;return!1}let Q={done:!0,value:void 0};function R(a,b){a=(a||g.$getRoot()).getLatest();let c=S(a),d=a,e=c,f=!0,h={next(){if(null===d)return Q;if(f)return f=!1,{done:!1,value:{depth:e,node:d}};if(d===b)return Q;if(g.$isElementNode(d)&&0<d.getChildrenSize())d=d.getFirstChild(),e++;else{let l;[d,l]=T(d)||[null,0];e+=l;null==b&&e<=c&&(d=null)}return null===d?Q:{done:!1,value:{depth:e,node:d}}},[Symbol.iterator](){return h}};return h}
function T(a){let b=null,c=0;for(;null===b&&null!==a;)b=a.getNextSibling(),null===b?(a=a.getParent(),c--):a=b;return null===a?null:[a,c]}function S(a){let b=0;for(;null!==(a=a.getParent());)b++;return b}let U=(a,b)=>{for(;a!==g.$getRoot()&&null!=a;){if(b(a))return a;a=a.getParent()}return null},V=H||!E?!1:void 0;function W(a,b,c){let d=!1;for(let e of X(a))b(e)?null!==c&&c(e):(d=!0,g.$isElementNode(e)&&W(e,b,c?c:f=>e.insertAfter(f)),e.remove());return d}
function Y(a){return{[Symbol.iterator]:()=>Z(a.getFirstChild(),b=>b.getNextSibling())}}function X(a){return{[Symbol.iterator]:()=>Z(a.getLastChild(),b=>b.getPreviousSibling())}}function Z(a,b){let c=a;return{next(){if(null===c)return Q;let d={done:!1,value:c};c=b(c);return d}}}exports.$splitNode=g.$splitNode;exports.isBlockDomNode=g.isBlockDomNode;exports.isHTMLAnchorElement=g.isHTMLAnchorElement;exports.isHTMLElement=g.isHTMLElement;exports.isInlineDomNode=g.isInlineDomNode;
exports.$descendantsMatching=function(a,b){let c=[];a=[...a].reverse();for(let d=a.pop();void 0!==d;d=a.pop())if(b(d))c.push(d);else if(g.$isElementNode(d))for(let e of X(d))a.push(e);return c};exports.$dfs=function(a,b){return Array.from(R(a,b))};exports.$dfsIterator=R;exports.$filter=function(a,b){let c=[];for(let d=0;d<a.length;d++){let e=b(a[d]);null!==e&&c.push(e)}return c};exports.$findMatchingParent=U;exports.$firstToLastIterator=Y;exports.$getDepth=S;
exports.$getNearestBlockElementAncestorOrThrow=function(a){let b=U(a,c=>g.$isElementNode(c)&&!c.isInline());g.$isElementNode(b)||C(4,a.__key);return b};exports.$getNearestNodeOfType=function(a,b){for(;null!=a;){if(a instanceof b)return a;a=a.getParent()}return null};exports.$getNextRightPreorderNode=function(a){if(g.$isElementNode(a)&&0<a.getChildrenSize())a=a.getLastChild();else{let b=null;for(;null===b&&null!==a;)b=a.getPreviousSibling(),a=null===b?a.getParent():b}return a};
exports.$getNextSiblingOrParentSibling=T;exports.$insertFirst=function(a,b){let c=a.getFirstChild();null!==c?c.insertBefore(b):a.append(b)};
exports.$insertNodeToNearestRoot=function(a){var b=g.$getSelection()||g.$getPreviousSelection();if(g.$isRangeSelection(b)){var {focus:c}=b;b=c.getNode();c=c.offset;if(g.$isRootOrShadowRoot(b))c=b.getChildAtIndex(c),null==c?b.append(a):c.insertBefore(a),a.selectNext();else{let d,e;g.$isTextNode(b)?(d=b.getParentOrThrow(),e=b.getIndexWithinParent(),0<c&&(e+=1,b.splitText(c))):(d=b,e=c);[,b]=g.$splitNode(d,e);b.insertBefore(a);b.selectStart()}}else null!=b?(b=b.getNodes(),b[b.length-1].getTopLevelElementOrThrow().insertAfter(a)):
g.$getRoot().append(a),b=g.$createParagraphNode(),a.insertAfter(b),b.select();return a.getLatest()};exports.$isEditorIsNestedEditor=function(a){return null!==a._parentEditor};exports.$lastToFirstIterator=X;exports.$restoreEditorState=function(a,b){let c=new Map,d=a._pendingEditorState;for(let [e,f]of b._nodeMap)c.set(e,g.$cloneWithProperties(f));d&&(d._nodeMap=c);a._dirtyType=2;a=b._selection;g.$setSelection(null===a?null:a.clone())};
exports.$unwrapAndFilterDescendants=function(a,b){return W(a,b,null)};exports.$unwrapNode=function(a){for(let b of Y(a))a.insertBefore(b);a.remove()};exports.$wrapNodeInElement=function(a,b){b=b();a.replace(b);b.append(a);return b};exports.CAN_USE_BEFORE_INPUT=aa;exports.CAN_USE_DOM=E;exports.IS_ANDROID=I;exports.IS_ANDROID_CHROME=da;exports.IS_APPLE=G;exports.IS_APPLE_WEBKIT=ia;exports.IS_CHROME=J;exports.IS_FIREFOX=H;exports.IS_IOS=ca;exports.IS_SAFARI=ba;
exports.addClassNamesToElement=function(a,...b){b=K(...b);0<b.length&&a.classList.add(...b)};
exports.calculateZoomLevel=function(a){let b=1;if(void 0===V){let c=document.createElement("div");c.style.cssText="position: absolute; opacity: 0; width: 100px; left: -1000px;";document.body.appendChild(c);let d=c.getBoundingClientRect();c.style.setProperty("zoom","2");V=c.getBoundingClientRect().width===d.width;document.body.removeChild(c)}if(V)for(;a;)b*=Number(window.getComputedStyle(a).getPropertyValue("zoom")),a=a.parentElement;return b};exports.isMimeType=P;exports.markSelection=O;
exports.mediaFileReader=function(a,b){let c=a[Symbol.iterator]();return new Promise((d,e)=>{let f=[],h=()=>{const {done:l,value:m}=c.next();if(l)return d(f);const k=new FileReader;k.addEventListener("error",e);k.addEventListener("load",()=>{const p=k.result;"string"===typeof p&&f.push({file:m,result:p});h()});P(m,b)?k.readAsDataURL(m):h()};h()})};exports.mergeRegister=L;exports.objectKlassEquals=function(a,b){return null!==a?Object.getPrototypeOf(a).constructor.name===b.name:!1};
exports.positionNodeOnRange=M;
exports.registerNestedElementResolver=function(a,b,c,d){return a.registerNodeTransform(b,e=>{a:{var f=e.getChildren();for(var h=0;h<f.length;h++)if(f[h]instanceof b){f=null;break a}for(f=e;null!==f;)if(h=f,f=f.getParent(),f instanceof b){f={child:h,parent:f};break a}f=null}if(null!==f){const {child:l,parent:m}=f;if(l.is(e)){d(m,e);e=l.getNextSiblings();f=e.length;m.insertAfter(l);if(0!==f){h=c(m);l.insertAfter(h);for(let k=0;k<f;k++)h.append(e[k])}m.canBeEmpty()||0!==m.getChildrenSize()||m.remove()}}})};
exports.removeClassNamesFromElement=function(a,...b){b=K(...b);0<b.length&&a.classList.remove(...b)};exports.selectionAlwaysOnDisplay=function(a){let b=null,c=()=>{var d=getSelection();d=d&&d.anchorNode;const e=a.getRootElement();null!==d&&null!==e&&e.contains(d)?null!==b&&(b(),b=null):null===b&&(b=O(a))};document.addEventListener("selectionchange",c);return()=>{null!==b&&b();document.removeEventListener("selectionchange",c)}}
